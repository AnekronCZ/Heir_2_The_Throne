#textdomain wesnoth-tdg
# scenario by Dalas

[scenario]
    id,map_file,name=01_The_Elves_Besieged,01_The_Elves_Besieged.map,_"The Elves Besieged"
    next_scenario,victory_when_enemies_defeated=00_The_Great_Continent,no
    {DEFAULT_SCHEDULE} # dawn, thus why konrad is sleeping
    turns=-1
          {SCENARIO_MUSIC wanderer.ogg}
    {EXTRA_SCENARIO_MUSIC traveling_minstrels.ogg}
    
    
    #######################################################################################################################################################
    #                                                                    HTTT INTRO
    #######################################################################################################################################################
    [story]
        [part]
            music=revelation.ogg
            story= _ "In the twenty-eighth year of the reign of Garard II, King of Wesnoth, the kingdom was plunged into a bitter war with the Orcs of the North."
            {HTTT_BIGMAP}
        [/part]
        [part]
            # wmllint: local spelling Galcadar
            story= _ "The Northern host encamped at Galcadar, by the Ford of Abez, and the King led his forces to meet them. Years of war brought Wesnoth to the brink of ruin, but at long last victory was won through the actions of Garard’s arch-mage, Delfador."
            {HTTT_BIGMAP}
        [/part]
        [part]
            story= _ "Garard’s son, the Crown Prince Eldred, joined in the revelry as the King celebrated his victory. Eldred was bright and driven, and might one day have grown into a wise ruler. But unfortunately for Garard, his son was also ambitious... and treacherous."
            background=story/httt_story1.webp
        [/part]
        [part]
            story= _ "At the height of Garard’s triumph, Eldred struck the old King down in cold blood. Proclaiming himself heir, the young prince led his father’s army south towards Weldyn."
            background=story/httt_story2.webp
        [/part]
        [part]
            story= _ "Garard’s queen, Asheviere, looked on with glee, having orchestrated much of Eldred’s treachery. The rule of her son would surely satisfy her lust for power far better than her husband’s had."
            background=story/httt_story3.webp
        [/part]
        [part]
            story= _ "But Delfador the arch-mage had not fallen alongside his king. Returning from a distant battle, he mustered a force of loyalists to fight the young prince and avenge the King’s death. The loyalist army marched south to meet Eldred."
            background=story/httt_story4.webp
        [/part]
        [part]
            story= _ "Eldred made war upon Delfador and his forces with his mother’s advice ringing in his ears: <i>“Fight no one great or small except the old mage, whose head should be severed from his shoulders.”</i>"
            {HTTT_BIGMAP}
        [/part]
        [part]
            story= _ "And Eldred did indeed meet Delfador face-to-face in battle, along the high road to Weldyn. Sword clashed against staff, as the wise old mage fought the brash young warrior."
            background=story/httt_story5.webp
        [/part]
        [part]
            story= _ "In the end Delfador’s men were defeated and routed, but Asheviere found her son’s lifeless body, fixed to the ground by the great mage’s staff."
            background=story/httt_story6.webp
        [/part]
        [part]
            story= _ "Asheviere herself then took command of the army and led it back to Weldyn. Knowing that the King’s young nephews were next in line to the throne, she ordered them all killed, and declared herself Queen of Wesnoth."
            {HTTT_BIGMAP}
        [/part]
        [part]
            story= _ "Soon after news of Asheviere’s orders reached Delfador, he secretly entered the palace and stole away Konrad, the youngest of Garard’s nephews, thereby saving him from death."
            background=story/httt_story7.webp
        [/part]
        [part]
            story= _ "Fleeing to the Aethenwood beyond the south-western border of Wesnoth, Delfador raised the child Konrad under the protection of the elves, watching sadly as Asheviere’s reign of terror over the land began..."
            background=story/httt_story8.webp
        [/part]
    [/story]
    
    
    #######################################################################################################################################################
    #                                                                   KONRAD AT HOME
    #######################################################################################################################################################
    # need to do this last, because it temporariy stores all the previously-created units
    [event]
        name=prestart
        [store_unit]
            {FILTER( id=Konrad )}
            kill,variable=yes,stored_s01_konrad
        [/store_unit]
        [store_unit]
            {FILTER( {NOT id=Konrad} )}
            kill,variable=yes,stored_s01_units
        [/store_unit]
        
        #############################
        # SET UP NEW MAP
        #############################
        [replace_map]
            map_file=01a_Home.map
            expand,shrink=yes,yes
        [/replace_map]
        [zoom]
            factor,relative=0.8,no
        [/zoom]
        {PLACE_IMAGE items/gohere.png            17 11}
        {PLACE_IMAGE items/gohere.png            18 10}
        {PLACE_IMAGE items/bed.png               13  5}
        {PLACE_IMAGE items/flower-blue.png       12  4}
        {PLACE_IMAGE items/flower-orange.png     13  4}
        {PLACE_IMAGE "items/flower-red.png~FL()" 14  5}
        {PLACE_IMAGE items/flower3.png           15 11}
        {PLACE_IMAGE items/boxes.png             10  6}
        {PLACE_IMAGE items/desk.png              11  6}
        {PLACE_IMAGE items/chair.png             12  6}
        {PLACE_IMAGE items/konrad-weapons.png    12  7}
        {PLACE_HALO  items/counter.png           18  6}
        {PLACE_HALO  items/bookshelves.png       15  7}
        {GENERIC_UNIT 4 Quintain 9 11} {FACING ne}
        {GENERIC_UNIT 4 Quintain 9 12} {FACING ne}
        [zoom]
            factor,relative=1,no
        [/zoom]
        [place_shroud]
            side=1 # fill entire map with shroud
        [/place_shroud]
        [change_theme]
            theme=Cutscene_Minimal
        [/change_theme]
        {SCROLL_TO 13 1}
        
        # this gold pickup serves as a lure, to make players trigger the bookshelf event
        # (and the bookshelf event teaches the player that there are more events in the house)
        {GOLD_PICKUP 17 6 items/gold-coins-small.png 10 "10 gold" _"A few coins for use in Delfador’s magical experiments. I’m sure they won’t be missed."}
        [modify_side]
            side,income=1,-2
        [/modify_side]
        
    [/event]
    
    #############################
    # EMULATE BIGMAP
    #############################
    [event]
        name=start
        [disallow_end_turn]
        [/disallow_end_turn]
    [/event]
    [event]
        name=moveto,unit placed,attack end
        first_time_only=no
        {FILTER id=Konrad}
        {FILTER_CONDITION( {HAVE_UNIT type=Quintain} )}
        [heal_unit]
            {FILTER id=$unit.id}
            moves=full
        [/heal_unit]
        {FULL_HEAL ()}
    [/event]
    [event]
        name=enter hex,unit placed
        first_time_only=no
        {FILTER id=Konrad}
        {FILTER_CONDITION( {HAVE_UNIT type=Quintain} )}
        [remove_shroud]
            {FILTER_SIDE side=1}
            x,y,radius=$unit.x,$unit.y,7
        [/remove_shroud]
    [/event]
    
    #############################
    # KONRAD WAKES UP
    #############################
    [event]
        name=start
        {DELAY 1500}
        [message]
            speaker=narrator
            message=_"<span size='xx-small'>Konrad!</span>"
        [/message]
        [message]
            speaker=narrator
            message=_"<span size='small'>Konrad, wake up!</span>"
        [/message]
        {DELAY 1000}
        {SCREEN_FADER 0,0,0 255 0} # fade out now and back in later, so that shroud removal looks gradual
        [unit]
            {SINGLEUNITWML_KONRAD}
            side,x,y,facing=1,13,5,ne
            type=Sleeping_Fighter
        [/unit]
        {MODIFY_UNIT id=Konrad ellipse none}
        {SCREEN_FADER 0,0,0 000 500}
        [message]
            speaker=Konrad
            message=_"*yawn*, what a vivid dream. Asheviere and Eldred, Delfador and Garard, just like in the stories. Of course, Delfador would have been younger back then..."
        [/message]
        {DELAY 500}
        [message]
            # if we're assuming the player is coming from TDG/AA/L, they don't yet know that Delfador is old (though the intro images are a pretty good clue)
            speaker,caption,image=narrator,_"Delfador",portraits/delfador-elvish-unknown.png 
            message=_"Wake up, wake up, wake up! Curse you Konrad, get up and get out here! We’re under attack!"
        [/message]
        {DELAY 250}
        [unit]
            {SINGLEUNITWML_KONRAD}
            side,x,y,facing=1,13,5,sw
            type=Unarmed_Fighter
            overwrite=yes
        [/unit]
        {DELAY 250}
        [message]
            speaker=Konrad
            message=_"I’m up, I’m up. What’s training today, Delfador? Orcs in the walls? Magi under my bedsheets?"
        [/message]
        [message]
            speaker,caption,image=narrator,_"Delfador",portraits/delfador-elvish-unknown.png
            message=_"No, you daft child, nothing like that! Grab your sword and come outside!"
        [/message]
        
        #############################
        # KONRAD GRABS HIS SWORD
        #############################
        {DELAY 500}
        {MOVE_UNIT id=Konrad 12 7}
        {FIRE_EVENT_UNIT enter_hex id=Konrad}
        {MODIFY_UNIT id=Konrad facing se}
        {DELAY 500}
        {REMOVE_IMAGE 12 7}
        [unstore_unit]
            x,y,variable=12,7,stored_s01_konrad
        [/unstore_unit]
        {CLEAR_VARIABLE stored_s01_konrad}
        {GIVE_OBJECT_TO id=Konrad (
            id=konrad_emulate_bigmap
            {EFFECT movement set=50}
            {EFFECT movement_costs (replace=yes
                [movement_costs]
                    flat,sand,frozen,village,castle=1,1,1,1,1
                    deep_water,shallow_water,reef,swamp_water=
                    forest,hills,mountains,fungus,unwalkable=
                [/movement_costs] )}
            {EFFECT vision set=0}
        )}
        {MODIFY_UNIT id=Konrad moves 50}
        [message]
            speaker=Konrad
            message=_"<span size='small'>Well, I’d better do as he says. Last time I missed battle training, Ethiliel made me spend all week transcribing her poetry. *shudder*</span>"
        [/message]
        [objectives]
            [objective]
                description= _ "Explore your home"
                condition=win
            [/objective]
            [objective]
                description= _ "Meet Delfador"
                condition=win
            [/objective]
        [/objectives]
        
        #############################
        # FLOWER EVENT
        #############################
        [event]
            name=enter hex
            {FILTER x,y=15,11}
            {FILTER_CONDITION( {HAVE_UNIT type=Quintain} )}
            [message]
                speaker=Konrad
                message=_"*sniff* Delicate and sweet. Delfador and Kaylan know lots about warfare and politics, but miss Ethiliel is the one who understands beauty."
            [/message]
            [cancel_action]
            [/cancel_action]
        [/event]
        
        #############################
        # BED EVENT
        #############################
        [event]
            name=enter hex
            {FILTER x,y=13,5}
            {FILTER_CONDITION( {HAVE_UNIT type=Quintain} )}
            [message]
                speaker=Konrad
                message=_"No time to rest! Got to train hard if I ever want to be a good king."
            [/message]
            [cancel_action]
            [/cancel_action]
        [/event]
        
        #############################
        # DESK EVENT
        #############################
        [event]
            name=enter hex
            {FILTER( {FILTER_LOCATION x,y,radius=11,6,1} )}
            {FILTER_CONDITION( {HAVE_UNIT type=Quintain} )}
            [message]
                speaker=Konrad
                message=_"Looks like Delfador’s written part of a letter. “<i>Sir Kaylan, I hope this missive finds you well. Lord Maddock’s latest report is worrying: the recent mobilization suggests...</i>”"
            [/message]
            [message]
                speaker=Konrad
                message=_"The letter trails off there."
            [/message]
            [cancel_action]
            [/cancel_action]
        [/event]
        
        #############################
        # BOOKSHELF EVENT
        #############################
        [event]
            name=enter hex
            {FILTER x,y=16-17,7}
            {FILTER_CONDITION( {HAVE_UNIT type=Quintain} )}
            [message]
                speaker=Konrad
                message=_"“<i>Ambassador Deoran’s Political Primer</i>”
“<i>Basics of Swordsmanship, feat. Captain Selli</i>”
“<i>An Abridged History of Wesnoth, by Delfador</i>”"
            [/message]
            [message]
                speaker=Konrad
                message=_"My textbooks, courtesy of Delfador. The shelves get fuller every day."
            [/message]
            [cancel_action]
            [/cancel_action]
        [/event]
        
        #############################
        # RIVER EVENT
        #############################
        [event]
            name=enter hex
            {FILTER( {FILTER_LOCATION terrain=W*^*} )}
            {FILTER_CONDITION( {HAVE_UNIT type=Quintain} )}
            {SOUND water.wav}
            [message]
                speaker=Konrad
                message=_"Ahhh, cool and refreshing. Delfador would probably worry it’s been poisoned."
            [/message]
            [cancel_action]
            [/cancel_action]
        [/event]
        
        #############################
        # QUINTAIN EVENT
        #############################
        [event]
            name=attack end
            {FILTER_CONDITION( {HAVE_UNIT type=Quintain} )}
            [message]
                speaker=Konrad
                message=_"Hi-ya! Take that Eldred! Take that Asheviere!"
            [/message]
        [/event]
        [event]
            name,first_time_only=attack end,no
            {FILTER_CONDITION( {HAVE_UNIT type=Quintain} )}
            {MODIFY_UNIT id=Konrad attacks_left 1}
        [/event]
    [/event]
    #######################################################################################################################################################
    #                                                                 KONRAD LEAVES HOME
    #######################################################################################################################################################
    [event]
        name=enter hex
        {FILTER( x,y=17,11 {OR x,y=18,10} )}
        [cancel_action]
        [/cancel_action]
        [message]
            speaker=Konrad
            message=_"Well, time to see what Delfador’s so excited about."
        [/message]
        {MOVE_UNIT id=Konrad 28 17}
        
        #############################
        # CLEAN UP
        #############################
        {SCREEN_FADER 0,0,0 255 500}
        {REMOVE_IMAGE 0-99 0-99}
        {REMOVE_LABEL 0-99 0-99}
        {KILL type=Quintain}
        
        #############################
        # RESTORE BATTLE MAP
        #############################
        [replace_map]
            map_file=01_The_Elves_Besieged.map
            expand,shrink=yes,yes
        [/replace_map]
        [foreach]
            array=stored_s01_units
            [do][unstore_unit]
                variable=this_item
            [/unstore_unit][/do]
        [/foreach]
        {CLEAR_VARIABLE stored_s01_units}
        [remove_object]
            object_id=konrad_emulate_bigmap
        [/remove_object]
        [allow_end_turn]
        [/allow_end_turn]
        
        #############################
        # INITIALIZE GAME STATE
        #############################
        [modify_side]
            side,shroud,income=1,no,0
        [/modify_side]
        
        {FIRE_EVENT play_battle}
    [/event]
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    {KONRAD_SIDE {ON_DIFFICULTY4 90 70 55 40} SHROUD=yes}
        # +10 gold on all difficulties from a pickup in Konrad's house
        # shroud only used for Konrad's house
    
    #############################
    # ELVES
    #############################
    [side]
        side,controller,color=2,ai,brightgreen
        {SINGLEUNITWML_ETHILIEL}
        hidden=yes
        recruit=Elvish Civilian
        gold,income={ON_DIFFICULTY4 20 30 40 50},0 # plus 4 villages
        team_name,user_team_name=konrad,_"Wesmere Elves"
        {FLAG_VARIANT wood-elvish}
    [/side]
    [side]
        side,controller,color=3,ai,brightgreen
        type,id,name=Elvish Marshal,Ithelden,_"Ithelden"
        profile=portraits/ithelden.webp
        {MODIFICATIONS( {TRAIT_STRONG} {TRAIT_RESILIENT} )}
        hidden=yes
        gold,income=75,5 # plus 2 villages
        recruit=Elvish Fighter,Elvish Archer
        team_name,user_team_name=konrad,_"Wesmere Elves"
        {FLAG_VARIANT6 ragged}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 2 0}
    {SILENTLY_LIMIT_LEADER_MOVES 3 0}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Elvish Archer" {ON_DIFFICULTY4 0 1 1 2}}
    [event] 
        name=play_battle
        [modify_side]{BR} side,hidden=2,no {BR}[/modify_side] 
        [modify_side]{BR} side,hidden=3,no {BR}[/modify_side] 
        [capture_village]{BR} side,x,y,radius=2,10,16,9 {BR}[/capture_village]
        [capture_village]{BR} side,x,y,radius=3,34,11,5 {BR}[/capture_village]
    [/event]
    [event]
        name=side 2 turn
        first_time_only=no
        {RESET_SIDE_AI 2,3 no 0.1 0.9}
        
        # Ethiliel's AI. Stay near leader, stay on forest, and avoid fires
        {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 3 x,y=10,11})}
        {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 3 x,y=14,14})}
        {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 2 x,y=12,13})}
        {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 2 x,y=14,11})}
        {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 2 x,y=13,10})}
        {MODIFY_SIDE_AI 2 ([avoid]
            {NOT( x,y,radius=12,12,4 )}
            {OR( find_in=fires )}
        [/avoid])}
        
        # Ithelden's AI. Stay near leader, stay on forest, and avoid fires
        {MODIFY_SIDE_AI 3 ({GOAL_LOCATION 3 x,y=35,8})}
        {MODIFY_SIDE_AI 3 ({GOAL_LOCATION 3 x,y=38,10})}
        {MODIFY_SIDE_AI 3 ({GOAL_LOCATION 2 x,y=36,9})}
        {MODIFY_SIDE_AI 3 ({GOAL_LOCATION 2 x,y=38,12})}
        {MODIFY_SIDE_AI 3 ({GOAL_LOCATION 1 x,y=33,9})}
        {MODIFY_SIDE_AI 3 ({GOAL_LOCATION 1 x,y=34,12})}
        {MODIFY_SIDE_AI 3 ([avoid]
            {NOT( x,y,radius=34,11,4 )}
            {OR( find_in=fires )}
        [/avoid])}
    [/event]
    
    
    #############################
    # MEN
    #############################
    [side]
        side,controller,color=4,ai,purple
        type,id,facing,gender=Red Mage,redmage,sw,female
        {MODIFICATIONS( {TRAIT_INTELLIGENT} {TRAIT_QUICK} )}
        gold,income={ON_DIFFICULTY4 20 30 40 50},{ON_DIFFICULTY4 -2 0 2 4} # plus 4 villages
        hidden,recruit=yes,Mage
        team_name,user_team_name=wesnoth,_"Army of Wesnoth"
        {FLAG_VARIANT loyalist}
    [/side]
    [side]
        side,controller,color=5,ai,purple
        type,id,facing=General,general,sw
        {MODIFICATIONS( {TRAIT_STRONG} {TRAIT_RESILIENT} )}
        gold,income={ON_DIFFICULTY4 20 30 40 50},{ON_DIFFICULTY4  0 3 5 8} # plus 5 villages
        hidden,recruit=yes,Spearman
        team_name,user_team_name=wesnoth,_"Army of Wesnoth"
        {FLAG_VARIANT loyalist}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 4 1}
    {SILENTLY_LIMIT_LEADER_MOVES 5 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Spearman"  {ON_DIFFICULTY4 0 1 2 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Bowman"    {ON_DIFFICULTY4 0 1 1 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Swordsman" {ON_DIFFICULTY4 0 1 2 3}}
    [event]
        name=play_battle
        [modify_side]{BR} side,hidden=4,no {BR}[/modify_side] 
        [modify_side]{BR} side,hidden=5,no {BR}[/modify_side] 
        [capture_village]{BR} side,x,y,radius=4,50,10,1 {BR}[/capture_village]
        [capture_village]{BR} side,x,y,radius=4,50,12,0 {BR}[/capture_village]
        [capture_village]{BR} side,x,y,radius=5,46,10,2 {BR}[/capture_village]
    [/event]
    
    [side]
        side,controller,color=6,ai,purple
        type,id,facing=Swordsman,swordsman,nw
        {MODIFICATIONS( {TRAIT_STRONG} {TRAIT_QUICK} )}
        gold,income={ON_DIFFICULTY4 30 45 60 75},{ON_DIFFICULTY4 -2 0 2 4}
        hidden,recruit=yes,Spearman
        team_name,user_team_name=wesnoth,_"Army of Wesnoth"
        {FLAG_VARIANT loyalist}
    [/side]
    [side]
        side,controller,color=7,ai,purple
        type,id,facing=Longbowman,longbowman,nw
        {MODIFICATIONS( {TRAIT_INTELLIGENT} {TRAIT_RESILIENT} )}
        gold,income={ON_DIFFICULTY4 30 45 60 75},{ON_DIFFICULTY4 -2 0 2 4}
        hidden,recruit=yes,Bowman
        team_name,user_team_name=wesnoth,_"Army of Wesnoth"
        {FLAG_VARIANT loyalist}
    [/side]
    [side]
        side,controller,color=8,ai,purple
        type,id,facing=Javelineer,javelineer,se
        {MODIFICATIONS( {TRAIT_STRONG} {TRAIT_RESILIENT} )}
        gold,income={ON_DIFFICULTY4 30 45 60 75},{ON_DIFFICULTY4 -2 0 2 4}
        hidden,recruit=yes,Spearman
        team_name,user_team_name=wesnoth,_"Army of Wesnoth"
        {FLAG_VARIANT loyalist}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 6 1}
    {SILENTLY_LIMIT_LEADER_MOVES 7 1}
    {SILENTLY_LIMIT_LEADER_MOVES 8 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Bowman"   {ON_DIFFICULTY4 0 1 1 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Spearman" {ON_DIFFICULTY4 0 1 1 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 8 "Bowman"   {ON_DIFFICULTY4 0 1 1 2}}
    {STARTING_VILLAGES_AREA 6 44 17 1}
    [event]
        name=play_battle
        [modify_side]{BR} side,hidden=6,no {BR}[/modify_side] # plus 3-5 villages
        [modify_side]{BR} side,hidden=7,no {BR}[/modify_side] # plus 3-5 villages
        [modify_side]{BR} side,hidden=8,no {BR}[/modify_side] # plus 3-5 villages
        [capture_village]{BR} side,x,y,radius=6,44,17,1 {BR}[/capture_village]
        [capture_village]{BR} side,x,y,radius=7,24,19,5 {BR}[/capture_village]
        [capture_village]{BR} side,x,y,radius=8,12,1,5  {BR}[/capture_village]
    [/event]
    [event]
        name=side 4 turn
        first_time_only=no
        {RESET_SIDE_AI 4,5   offensive 0.4 0.25}
        {RESET_SIDE_AI 6,7,8 offensive 0.4 0.25}
        
        {MODIFY_SIDE_AI 4,5,6 ({GOAL_SEEK_SIDE 99 1 0})}
        [if] {LUA(<<return wesnoth.current.turn<=5>>)} {THEN(
            {MODIFY_SIDE_AI 6,7,8 ({GOAL_SEEK_SIDE 99 2 0})}
        )} {ELSE(
            {MODIFY_SIDE_AI 6,7,8 ({GOAL_SEEK_SIDE 99 1 0})}
        )} [/if]
        
        # avoid fires
        [store_items]
            item_name,variable=fire,fires
        [/store_items]
        {MODIFY_SIDE_AI 4,5,6,7,8 ([avoid]
            find_in=fires
        [/avoid])}
    [/event]
    
    [side] # Delfador dummy side
        side,controller,color=9,null,red
        hidden,no_leader,team_name=yes,yes,konrad
    [/side]
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                  PLAY MAIN SCENARIO
    #######################################################################################################################################################
    [event]
        name=play_battle
        
        #############################
        # NORTHERn FIRES
        #############################
        {PLACE_FIRE  3  7}
        {PLACE_FIRE  3 10}
        {PLACE_FIRE  6 10}
        {PLACE_FIRE  8 10}
        {PLACE_FIRE  7 11}
        {PLACE_FIRE  7  8}
        {PLACE_FIRE 11  9}
        {PLACE_FIRE 12  9}
        {PLACE_FIRE 13  7}
        {PLACE_FIRE 14  6}
        {PLACE_FIRE 15  6}
        {PLACE_FIRE 15  4}
        
        {PLACE_FIRE 19  2}
        {PLACE_FIRE 20  1}
        {PLACE_FIRE 21  1}
        {PLACE_FIRE 28  1}
        {PLACE_FIRE 29  2}
        
        {PLACE_FIRE 36  4}
        {PLACE_FIRE 37  2}
        
        {PLACE_FIRE 27  1}
        {PLACE_FIRE 26  1}
        {PLACE_FIRE 29  1}
        {PLACE_FIRE 30  1}
        {PLACE_FIRE 31  1}
        {PLACE_FIRE 31  2}
        {PLACE_FIRE 33  5}
        {PLACE_FIRE 32  3}
        {PLACE_FIRE 32  4}
        
        #############################
        # EASTERN FIRES
        #############################
        {PLACE_FIRE 37  8}
        {PLACE_FIRE 39  8}
        {PLACE_FIRE 40  8}
        {PLACE_FIRE 39  9}
        {PLACE_FIRE 40  9}
        {PLACE_FIRE 42 11}
        {PLACE_FIRE 41 11}
        {PLACE_FIRE 43 12}
        {PLACE_FIRE 43 13}
        {PLACE_FIRE 43 14}
        {PLACE_FIRE 42 13}
        {PLACE_FIRE 45 11}
        
        #############################
        # SOUTHERN FIRES
        #############################
        {PLACE_FIRE 40 15}
        {PLACE_FIRE 39 15}
        {PLACE_FIRE 41 15}
        {PLACE_FIRE 30 15}
        {PLACE_FIRE 28 15}
        {PLACE_FIRE 23 16}
        {PLACE_FIRE 22 16}
        {PLACE_FIRE 21 16}
        {PLACE_FIRE 18 20}
        {PLACE_FIRE 18 19}
        
        # on higher difficulties, the fires push further
        {REPEAT {ON_DIFFICULTY4 1 2 3 4} ({FIRE_EVENT tick_fires})}
        
        
        #############################
        # ELVISH GUARDS
        #############################
        {GENERIC_UNIT 2 (Elvish Ranger)  14 14} {FACING nw} {GENDER female} {ZONE_GUARDIAN 14 14 x,y,radius=11,12,2}
        {GENERIC_UNIT 2 (Elvish Archer)  10 11} {FACING ne} {GENDER male  } {ZONE_GUARDIAN 10 11 x,y,radius=13,14,2}
        {GENERIC_UNIT 2 (Elvish Archer)  18 11} {FACING nw} {GENDER female} {ZONE_GUARDIAN 18 11 x,y,radius=17,11,2}
        {GENERIC_UNIT 3 (Elvish Fighter) 35  8} {FACING ne} {ZONE_GUARDIAN 35  8 x,y,radius=33,8,1}
        {GENERIC_UNIT 3 (Elvish Hero)    38 10} {FACING nw} {ZONE_GUARDIAN 38 10 x,y,radius=38,10,1}
        {GENERIC_UNIT 3 (Elvish Archer)  34 10} {FACING ne} {GENDER female}
        
        #############################
        # HUMAN GUARDS
        #############################
        {GENERIC_UNIT 4 (Bowman)    42  5} {FACING sw} {ZONE_GUARDIAN 42  5 ( x,y,radius=44,5,3 {OR x,y,radius=48,9,4} )}
        {GENERIC_UNIT 4 (Swordsman) 46  6} {FACING sw} {ZONE_GUARDIAN 46  6 ( x,y,radius=44,5,3 {OR x,y,radius=48,9,4} )}
        {GENERIC_UNIT 5 (Spearman)  45 10} {FACING sw} {ZONE_GUARDIAN 45 10 ( x,y,radius=44,5,3 {OR x,y,radius=48,9,4} )}
        {GENERIC_UNIT 5 (Spearman)  46 11} {FACING sw} {ZONE_GUARDIAN 46 11 ( x,y,radius=44,5,3 {OR x,y,radius=48,9,4} )}
        {GENERIC_UNIT 6 (Spearman)   7  3} {FACING se} {ZONE_GUARDIAN  7  3 ( x,y,radius=6,1,3 )}
        {GENERIC_UNIT 6 (Bowman)     3  2} {FACING se} {ZONE_GUARDIAN  3  2 ( x,y,radius=6,1,3 )}
        {GENERIC_UNIT 7 (Spearman)  30 18} {FACING nw} {ZONE_GUARDIAN 30 18 ( x,y,radius=28,20,4 )}
        {GENERIC_UNIT 7 (Spearman)  31 19} {FACING ne} {ZONE_GUARDIAN 31 19 ( x,y,radius=28,20,4 )}
        
        #############################
        # HUMAN ATTACKERS
        #############################
        {GENERIC_UNITC 4 {ON_DIFFICULTY4 "none"     "none"     "none"     "Mage"     } 43  4 ()}
        {GENERIC_UNITC 4 {ON_DIFFICULTY4 "none"     "Mage"     "Mage"     "Mage"     } 44  5 ()}
        {GENERIC_UNITC 4 {ON_DIFFICULTY4 "none"     "none"     "Mage"     "Mage"     } 45  5 ()}
        {GENERIC_UNITC 5 {ON_DIFFICULTY4 "none"     "Spearman" "Spearman" "Swordsman"} 47  8 ()}
        {GENERIC_UNITC 5 {ON_DIFFICULTY4 "none"     "none"     "Spearman" "Spearman" } 48  8 ()}
        {GENERIC_UNITC 5 {ON_DIFFICULTY4 "none"     "none"     "Spearman" "Spearman" } 49  8 ()}
        {GENERIC_UNITC 5 {ON_DIFFICULTY4 "none"     "none"     "none"     "Bowman"   } 48  6 ()}
        
        {GENERIC_UNITC 6 {ON_DIFFICULTY4 "none"     "none"     "none"     "Spearman" } 41 18 ()}
        {GENERIC_UNITC 6 {ON_DIFFICULTY4 "none"     "Spearman" "Spearman" "Spearman" } 41 19 ()}
        {GENERIC_UNITC 6 {ON_DIFFICULTY4 "none"     "none"     "Bowman"   "Bowman"   } 43 18 ()}
        
        {GENERIC_UNITC 7 {ON_DIFFICULTY4 "none"     "none"     "none"     "Spearman" } 27 20 ()}
        {GENERIC_UNITC 7 {ON_DIFFICULTY4 "Bowman"   "Bowman"   "Bowman"   "Bowman"   } 27 19 ()}
        {GENERIC_UNITC 7 {ON_DIFFICULTY4 "none"     "Spearman" "Spearman" "Spearman" } 28 18 ()}
        {GENERIC_UNITC 7 {ON_DIFFICULTY4 "none"     "none"     "Spearman" "Spearman" } 22 20 ()}
        {GENERIC_UNITC 8 {ON_DIFFICULTY4 "none"     "none"     "Bowman"   "Bowman"   } 24 20 ()}
        
        {GENERIC_UNITC 8 {ON_DIFFICULTY4 "none"     "none"     "Spearman" "Spearman" }  6  1 ()}
        {GENERIC_UNITC 8 {ON_DIFFICULTY4 "Spearman" "Spearman" "Spearman" "Spearman" }  8  1 ()}
        {GENERIC_UNITC 8 {ON_DIFFICULTY4 "none"     "none"     "none"     "Bowman"   }  9  1 ()}
        {GENERIC_UNITC 8 {ON_DIFFICULTY4 "none"     "Spearman" "Spearman" "Spearman" } 11  2 ()}
        {GENERIC_UNITC 8 {ON_DIFFICULTY4 "none"     "none"     "Bowman"   "Bowman"   } 12  1 ()}
        
        #############################
        # KONRAD
        #############################
        {PUT_TO_RECALL_LIST id=Konrad}
        {GIVE_OBJECT_TO id=Konrad (
            id=konrad_silver_crown_object
            {EFFECT overlay remove=misc/leader-crown.png}
            {EFFECT overlay add=misc/leader-expendable.png}
        )}
        
        #############################
        # DELFADOR
        #############################
        [unit]
            {SINGLEUNITWML_DELFADOR}
            side,x,y,facing=9,25,6,sw
            hitpoints,experience=27,5
            extra_recruit=Fire Guardian,Fire Wraith
        [/unit]
        {GENERIC_UNIT 9 "Fire Wraith"   23 5} {ROLE wraith} {FACING sw} {HITPOINTS 36}
        {GENERIC_UNIT 9 "Fire Guardian" 24 7} {ROLE fguard} {FACING ne} {HITPOINTS  8}
        {GENERIC_UNIT 6 "Silver Mage"   23 6} {ROLE smage1} {FACING sw} {HITPOINTS 22} {GENDER female}
        {GENERIC_UNIT 6 "Silver Mage"   24 6} {ROLE smage2} {FACING ne} {HITPOINTS 15} {GENDER male  }
        {GENERIC_UNIT 6 "Assassin"      26 5} {ROLE assass} {FACING se} {HITPOINTS 14} {GENDER female}
        [capture_village]{BR} side,x,y,radius=1,25,8,5 {BR}[/capture_village]
        {SCROLL_TO 25 6}
        
        
        
        #############################
        # PLAY CUTSCENE
        #############################
        # cutscene establishes that 1) Delfador is old now, and 2) Delfador is still plenty powerful
        {FADE_MUSIC_OUT 500}
        {REPLACE_SCENARIO_MUSIC siege_of_laurelmor.ogg}
        {APPEND_MUSIC the_city_falls.ogg}
        {FADE_MUSIC_IN 100}
        {SCREEN_FADER 0,0,0 000 500}
        {DELAY 500}
        [message]
            speaker,image=Delfador,portraits/delfador-mad.webp
            message=_"Begone with you, servants of Asheviere! Only fools dare oppose me!"
        [/message]
        {MOVE_UNIT    role=wraith 24 5}
        {ANIMATE_HARM role=wraith  8 range=ranged role=smage1}
        {ANIMATE_HARM role=smage1  5 range=ranged role=wraith}
        {ANIMATE_HARM role=wraith  8 range=ranged role=smage1}
        {ANIMATE_HARM role=smage1  5 range=ranged role=wraith}
        {ANIMATE_HARM role=smage1  5 range=ranged role=wraith}
        {ANIMATE_HARM role=smage1  5 range=ranged role=wraith}
        {DELAY 250}
        {ANIMATE_HARM role=smage2 5 range=ranged role=fguard}
        {ANIMATE_HARM role=fguard 8 range=ranged role=smage2}
        {ANIMATE_HARM role=smage2 5 range=ranged role=fguard}
        {DELAY 250}
        {MOVE_UNIT    role=assass 24 4} {DELAY 250}
        {ANIMATE_HARM role=assass 16 range=melee  role=wraith}
        {DELAY 250}
        {MOVE_UNIT    id=Delfador 24 5} {DELAY 250}
        {ANIMATE_HARM id=Delfador 14 range=ranged role=assass}
        {ANIMATE_HARM id=Delfador  7 range=ranged role=smage1}
        {ANIMATE_HARM id=Delfador  7 range=ranged role=smage2}
        {DELAY 500}
        {MOVE_UNIT id=Delfador 25 6}
        {MODIFY_UNIT id=Delfador facing sw}
        {DELAY 500}
        [message]
            speaker=Delfador
            message=_"Serves you right, sneaking up on an old man like that! Hmph, nearly gave me a heart attack."
        [/message]
        
        #############################
        # EXPLAIN SCENARIO
        #############################
        {RECALL_XY Konrad 29 6}
        {MODIFY_UNIT id=Konrad facing sw}
        {MODIFY_UNIT id=Delfador facing ne}
        {DELAY 500}
        [message]
            speaker,image=Konrad,portraits/konrad-elvish-concerned.webp
            message=_"I’m here, Delfador! Sorry it took so long! I thought you were calling me for more training, but that was a real battle, wasn’t it? What’s going on?"
        [/message]
        [message]
            speaker,image=Ethiliel,portraits/ethiliel-mad.webp
            message=_"Trouble from your “Queen Asheviere”, human! She must know we sheltered you throughout your childhood. Now she comes bearing firey retribution, and the dawn of a dark age for our people."
        [/message]
        {SCROLL_TO 1   1} {DELAY 750}
        {SCROLL_TO 50  1} {DELAY 750}
        {SCROLL_TO 50 20} {DELAY 750}
        [message]
            speaker=Delfador
            message=_"And those assassins I just defeated were after you personally, master Konrad! We need to get you out of here!"
        [/message]
        [message]
            speaker,image=Konrad,portraits/konrad-elvish-concerned.webp
            #po: it's a little odd for Konrad (a human) to refer to them as "the humans", but keep in mind he was raised among elves
            message=_"But Delfador, the humans are burning our home! They’re trying to kill our friends! We have to help fight."
        [/message]
        [message]
            speaker=Delfador
            #po: this is the first time we see the contrasts between Konrad and Delfador. Konrad wants to help the people in front of him. Delfador prefers to sacrifice for the greater picture.
            message=_"Do not throw your life away so easily, your highness. The true heir is a symbol of hope to everyone oppressed by Asheviere’s tyrrany, both men and elves alike! If you do not escape this battle, all chance of rebellion will be lost."
        [/message]
        [message]
            speaker=Ithelden
            message=_"Asheviere is all of ours’ enemy. We will fight the invaders, but you must escape, Konrad. Lord Kalenz has commanded your safety. It is imperative that you escape!"
        [/message]
        [message]
            speaker=Delfador
            message=_"There can be no looking back. We must go quickly!"
        [/message]
        
        [change_theme]
        [/change_theme]
        {MODIFY_UNIT side=9 side 1}
        
        #############################
        # OBJECTIVES
        #############################
        [objectives]
            [objective]
                description= _ "Move Konrad to the west edge of the map"
                condition=win
            [/objective]
            [objective]
                {BONUS_OBJECTIVE_CAPTION}
                description= _ "Protect Ithelden (+10 gold carryover)"
                [show_if] {HAVE_UNIT id=Ithelden} [/show_if]
                condition=win
            [/objective]
            [objective]
                {BONUS_OBJECTIVE_CAPTION}
                description= _ "Protect Ethiliel (+10 gold carryover)"
                [show_if] {HAVE_UNIT id=Ethiliel} [/show_if]
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Konrad or Delfador"
                condition=lose
            [/objective]
            [gold_carryover]
                carryover_percentage,bonus=40,no
            [/gold_carryover]
            [note]
                description= _ "Units take 1 fire damage whenever they enter flaming terrain, and take 10 fire damage if they end their turn in it."
            [/note]
        [/objectives]
    [/event]
    
    
    #######################################################################################################################################################
    #                                                                     GOLD BOOSTS
    #######################################################################################################################################################
# give gold per leader. Easier way to implement this than changing each side's income individually and per-difficulty
#define BONUS_INCOME_PER_LEADER INCOME
    # newline for inline usage
    [event]
        name,first_time_only=new turn,no
        [store_unit]
            {FILTER( canrecruit=yes {NOT side=1} )}
            variable=stored_enemy_leaders
        [/store_unit]
        [foreach]
            array=stored_enemy_leaders
            [do]
                [gold]
                    side=$this_item.side
                    amount={INCOME}
                [/gold]
            [/do]
        [/foreach]
    [/event]
#enddef
    [event]
        name=turn 5
        {BONUS_INCOME_PER_LEADER {ON_DIFFICULTY4 2 3 4 5}}
    [/event]
    [event]
        name=turn 10
        {BONUS_INCOME_PER_LEADER {ON_DIFFICULTY4 4 6 8 10}}
    [/event]
    [event]
        name=turn 15
        {BONUS_INCOME_PER_LEADER {ON_DIFFICULTY4 8 12 16 20}}
    [/event]
    [event]
        name=turn 20
        {BONUS_INCOME_PER_LEADER 300}
        [modify_side]
            side=4,5,6,7,8
            recruit=Royal Guard,Halberdier,Master Bowman,Arch Mage,Silver Mage
        [/modify_side]
    [/event]
    
    
    #######################################################################################################################################################
    #                                                                        FIRE
    #######################################################################################################################################################
    #############################
    # FIRE - HEX DAMAGE
    #############################
    [event]
        name=enter hex
        first_time_only=no
        {FILTER( {FILTER_LOCATION find_in=fires} )}
        [harm_unit]
            {FILTER id=$unit.id}
            amount,damage_type=1,fire
            fire_event=yes
        [/harm_unit]
    [/event]
    #############################
    # FIRE - TURN DAMAGE
    #############################
    [event]
        name=side turn end
        first_time_only=no
        [harm_unit]
            {FILTER( side=$side_number {FILTER_LOCATION find_in=fires} )}
            amount,damage_type=10,fire
            fire_event=yes
        [/harm_unit]
    [/event]
    #############################
    # FIRE - SPREAD & EXTINGUISH
    #############################
    [event]
        name=new turn,tick_fires
        first_time_only=no
        # if we do this on new turn, sometimes enemies/allies appear to stand in the fire even though they won't ever take damage from it, which is bad
        # but, if we do it on side 1 turn end, the burning forest can sometimes change enemy pathing, which is much worse. Best to stick with "new turn"
        
        #------------------
        # FIRES BURN
        #------------------
        [store_items]
            item_name=fire
            variable=fires
        [/store_items]
        [foreach]
            array=fires
            variable=fire
            [do]
                {VARIABLE_OP yesno rand "yes,yes,yes,no"} # 3/4 chance to trigger each turn; 3 triggers before fire goes out
                [if] {VARIABLE_CONDITIONAL yesno equals yes} {THEN(
                    # FIRST TRIGGER: replace ground with sand
                    [if] {HAVE_LOCATION( x,y=$fire.x,$fire.y {NOT terrain=Dd*^*,Ds*^*,Rrd*^*} )} {THEN(
                        {VARIABLE_OP sand rand "Dd,Ds,Rrd"}
                        [terrain]
                            x,y=$fire.x,$fire.y
                            layer,terrain=base,$sand
                        [/terrain]
                        {CLEAR_VARIABLE sand}
                        [continue][/continue]
                    )} [/if]
                    
                    # SECOND TRIGGER: replace lush forest with burned forest
                    [if] {HAVE_LOCATION( x,y,terrain=$fire.x,$fire.y,*^F* {NOT terrain=*^Fdw} )} {THEN(
                        [terrain]
                            x,y=$fire.x,$fire.y
                            layer,terrain=overlay,^Fdw
                        [/terrain]
                        [continue][/continue]
                    )} [/if]
                    
                    # THIRD TRIGGER: remove fire and (usually) remove forest
                    [if] {HAVE_LOCATION(x,y,terrain=$fire.x,$fire.y,*^Fdw)}
                        {NOT({HAVE_LOCATION(
                            {FILTER_ADJACENT_LOCATION x,y=$fire.x,$fire.y} # if an adjacent forest hex hasn't caught on fire yet, don't let this fire go out
                            terrain=*^F* {NOT terrain=*^Fdw} {NOT find_in=fires}
                        )})}
                    {THEN(
                        [remove_item]
                            x,y,image=$fire.x,$fire.y,"fire"
                        [/remove_item]
                        # 5/6 chance to remove the forest too
                        {VARIABLE_OP yesno rand "yes,yes,yes,yes,yes,no"}
                        [if] {VARIABLE_CONDITIONAL yesno equals yes} {THEN(
                            [terrain]
                                x,y=$fire.x,$fire.y
                                layer,terrain=overlay,"^"
                            [/terrain]
                        )} [/if]
                        [continue][/continue]
                    )} [/if]
                )} [/if]
            [/do]
        [/foreach]
        
        #------------------
        # FIRES SPREAD
        #------------------
        [store_items]
            item_name=fire
            variable=fires
        [/store_items]
        [foreach]
            array=fires
            variable=fire
            [do]
                # what are the adjacent hexes?
                [store_items]
                    item_name=fire
                    variable=fires_updated
                [/store_items]
                [store_locations]
                    {FILTER_ADJACENT_LOCATION x,y=$fire.x,$fire.y}
                    terrain=*^F* {NOT find_in=fires_updated} # don't prevent re-lighting ^Fdw hexes
                    variable=adjacent_nonburning_forests
                [/store_locations]
                {CLEAR_VARIABLE fires_updated}
                [foreach]
                    array=adjacent_nonburning_forests
                    variable=forest
                    [do]
                        {VARIABLE_OP yesno rand "yes,no,no"} # 1/3 chance (per adjacent fire, per turn) for a new fire to start
                        [if] {VARIABLE_CONDITIONAL yesno equals yes} {THEN(
                            {PLACE_FIRE $forest.x $forest.y}
                        )} [/if]
                    [/do]
                [/foreach]
            [/do]
        [/foreach]
        
        # update the "fires" array, so we have accurate data for events
        [store_items]
            item_name=fire
            variable=fires
        [/store_items]
    [/event]
    
    
    #######################################################################################################################################################
    #                                                                       FLAVOR
    #######################################################################################################################################################
    #############################
    # "I AM GALDRAD" (or Ithelden)
    #############################
    [event]
        name=attack {FILTER        id=Ithelden}
        {FIRE_EVENT ithelden_speaks}
    [/event]
    [event]
        name=attack {FILTER_SECOND id=Ithelden}
        {FIRE_EVENT ithelden_speaks}
    [/event]
    [event]
        name=ithelden_speaks
        [message]
            speaker=Ithelden
            message=_"Only by the authority of High Lord Kalenz may men set foot in the Aethenwood. Human, you are tresspassing. Prepare to die."
        [/message]
    [/event]
    #############################
    # KONRAD ATTACKS
    #############################
    [event]
        name=attack {FILTER        id=Konrad}
        {FILTER_CONDITION( {NOT({HAVE_UNIT type=Quintain})} )}
        {FIRE_EVENT konrad_speaks}
    [/event]
    [event]
        name=attack {FILTER_SECOND id=Konrad}
        {FILTER_CONDITION( {NOT({HAVE_UNIT type=Quintain})} )}
        {FIRE_EVENT konrad_speaks}
    [/event]
    [event]
        name=konrad_speaks
        [message]
            speaker,image=Konrad,portraits/konrad-elvish-mad.webp
            message=_"Leave my friends alone, you villian!"
        [/message]
        [message]
            speaker=second_unit
            #po: Asheveire's official stance is that Konrad is a fraud. Of course, the player later finds out that this is correct
            message=_"That’s him, it’s the fake prince! I’ll get him!"
        [/message]
    [/event]
    #############################
    # ENEMIES FLEE FROM DELFADOR
    #############################
    [event]
        name=attack
        {FILTER id=Delfador}
        {FILTER_SECOND level,canrecruit=1,no}
        [message]
            speaker=second_unit
            message=_"Oh no, it’s HIM, it’s Delfador THE GREAT! Get me out of here!"
        [/message]
        {KILL id=$second_unit.id}
        [if] {VARIABLE_CONDITIONAL second_unit.side equals 4} {THEN(
            {FAKE_UNIT_MOVE $second_unit.x 50 $second_unit.y 7 $second_unit.side $second_unit.type ()}
        )} [/if]
        [if] {VARIABLE_CONDITIONAL second_unit.side equals 5} {THEN(
            {FAKE_UNIT_MOVE $second_unit.x 50 $second_unit.y 7 $second_unit.side $second_unit.type ()}
        )} [/if]
        [if] {VARIABLE_CONDITIONAL second_unit.side equals 6} {THEN(
            {FAKE_UNIT_MOVE $second_unit.x 50 $second_unit.y 15 $second_unit.side $second_unit.type ()}
        )} [/if]
        [if] {VARIABLE_CONDITIONAL second_unit.side equals 7} {THEN(
            {FAKE_UNIT_MOVE $second_unit.x 24 $second_unit.y 20 $second_unit.side $second_unit.type ()}
        )} [/if]
        [if] {VARIABLE_CONDITIONAL second_unit.side equals 8} {THEN(
            {FAKE_UNIT_MOVE $second_unit.x  1 $second_unit.y  1 $second_unit.side $second_unit.type ()}
        )} [/if]
        [message]
            speaker=Delfador
            message=_"My reputation preceeds me."
        [/message]
        {MODIFY_UNIT id=Delfador attacks_left 1}
    [/event]
    #############################
    # DELFADOR CRITICIZES KONRAD
    #############################
    [event]
        name=turn 2
        [message]
            speaker=Delfador
            message=_"Konrad, it took you some time to rise this morning. I’m not angry, but I am worried. Those assassins were after you, not me! What would have happened if I hadn’t been there to keep you safe?"
        [/message]
    [/event]
    #############################
    # KONRAD’S NEVER SEEN THIS MANY HUMANS
    #############################
    [event]
        name=turn 5
        [message]
            speaker=Konrad
            message=_"I’ve never seen this many humans all in one place before! Delfador, they’re scary. I can’t believe you and I are really the same as them..."
        [/message]
        [message]
            speaker=Delfador
            message=_"I’m sorry you couldn’t have grown up among your own people, Konrad. Our kind can be a little crude, but we aren’t usually so bad — it’s Asheviere who’s stirred up all this mischief."
        [/message]
        [message]
            speaker=Delfador
            message=_"And if my suspicions are true, this is merely a small part of the greater whole of her armies! We must get out of this forest so we can see what else is going on."
        [/message]
    [/event]

    
    
    
    
    #######################################################################################################################################################
    #                                                                  VICTORY / DEFEAT
    #######################################################################################################################################################
    #############################
    # ENEMY LEADERS DIE
    #############################
    [event]
        name=die
        {FILTER_CONDITION( {NOT({HAVE_UNIT side=4,5,6,7,8})} )}
        [message]
            speaker=narrator
            message=_"Wow, you’ve defeated all the invaders and saved the Aethenwood! I didn’t expect this to be possible, so if you’re reading this message in-game you’ve exceeded all expectations! (or you’re cheating to see what happens)"
        [/message]
        [message]
            speaker=narrator
            message=_"Unfortunately this is a non-canon ending, so for the rest of the campaign we’re going to have to pretend that this never happened, ok?"
        [/message]
        {DELAY 500}
        {FIRE_EVENT victory_cutscene}
    [/event]
    #############################
    # ETHILIEL DIES
    #############################
    [event]
        name=last breath
        {FILTER id=Ethiliel}
        [message]
            speaker=Ethiliel
            message=_"I have given all in defense of my home..."
        [/message]
    [/event]
    #############################
    # ITHELDEN DIES
    #############################
    [event]
        name=last breath
        {FILTER id=Ithelden}
        [message]
            speaker=Ithelden
            #po: referring to Eltenmir from TSG
            message=_"Eltenmir was right. We should have burned your cities when we had the chance..."
        [/message]
    [/event]
    #############################
    # KONRAD ESCAPES
    #############################
    [event]
        name=moveto
        {FILTER id,x,y=Konrad,1,0-99}
        {FIRE_EVENT victory_cutscene}
    [/event]
    [event]
        name=victory_cutscene
        [message]
            speaker=Konrad
            message=_"I’m sorry I have to leave, everyone! All this destruction is my fault, and I wish I could have done more to help. I’ll make you all proud, I promise."
        [/message]
        [message]
            speaker=Delfador
            message=_"Time to go, Konrad! Come on!"
        [/message]
        
        [if] {HAVE_UNIT id=Ethiliel} {THEN(
            {VARIABLE ethiliel_alive yes}
            [gold]{BR} side,amount=1,25 {BR}[/gold] # 25 gold * 40% carryover = net 10 gold
        )} [/if]
        [if] {HAVE_UNIT id=Ithelden} {THEN(
            {VARIABLE ithelden_alive yes}
            [gold]{BR} side,amount=1,25 {BR}[/gold]
        )} [/if]
        
        {CLEAR_VARIABLE fires,groups_remaining}
        [endlevel]
            result=victory
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]
[/scenario]






