#textdomain wesnoth-h2tt

#define SCENARIO_TURN_LIMIT
20#enddef


[scenario]
    id,map_file,name=30a_The_Sceptre_of_Fire,30_The_Sceptre_of_Fire.map,_"The Sceptre of Fire"
    next_scenario,victory_when_enemies_defeated=00_The_Great_Continent,no
    {UNDERGROUND}
    turns={SCENARIO_TURN_LIMIT}
          {SCENARIO_MUSIC the_deep_path.ogg}
    {EXTRA_SCENARIO_MUSIC underground.ogg}
    {EXTRA_SCENARIO_MUSIC suspense.ogg}
    
    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    {KONRAD_SIDE 75 SHROUD=yes}
    
    #############################
    # MONSTERS
    #############################
    [side]
        side,controller,color=2,ai,brown
        type,id,facing="Giant Ant Queen",ant_leader,nw
        gold,income,recruit=0,{ON_DIFFICULTY4 0 2 6 6},Soldier Ant
        village_gold=0 # lots of villages, so reduce village income to 0 so that we don't need massive negative income to balance it out
        team_name,user_team_name=monsters,_"Monsters"
    [/side]
    {STARTING_VILLAGES 2 10}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Giant Ant" 2}
    [event]
        name,first_time_only=side 2 turn,no
        {RESET_SIDE_AI 2,3 no 0.9 0.1}
        {MODIFY_SIDE_AI 2 ({GOAL_LOCATION 0.5 x,y,radius=28,1,10})} # hang around near the sceptre; don't wander off
    [/event]
    [side]
        side,controller,color=3,ai,brown
        no_leader,hidden=yes,yes
        team_name,user_team_name=monsters,_"Monsters"
    [/side]
    
    #############################
    # WESNOTH
    #############################
#define WESNOTH_SIDE SIDE HIDDEN RECRUIT_LIST INCOME
    [side]
        side,controller,color={SIDE},ai,wesred
        no_leader,hidden=yes,{HIDDEN}
        gold,income=0,{INCOME} # high income, but no gold. The longer you take to reach the Sceptre, the more gold they'll have
        recruit={RECRUIT_LIST}
        village_gold=0 # lots of villages, so reduce village income to 0 so that we don't need massive negative income to balance it out (which is especially challenging across difficulties...)
        team_name,user_team_name=wesnoth,_"Wesnoth"
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES {SIDE} 2}
#enddef
    {WESNOTH_SIDE 4 no  "Shock Trooper,Duelist" {ON_DIFFICULTY4 2 6 14 14}} # leave Li'sar's side unhidden, so the player can see her gold going up each turn
    {WESNOTH_SIDE 5 yes "Spearman,Swordsman"    {ON_DIFFICULTY4 2 6 14 14}}
    {WESNOTH_SIDE 6 yes "Mage,Red Mage"         {ON_DIFFICULTY4 2 6 14 14}}
    {WESNOTH_SIDE 7 yes "Bowman,Longbowman"     {ON_DIFFICULTY4 2 6 14 14}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Heavy Infantryman" {ON_DIFFICULTY4 0 1 2 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Fencer"            {ON_DIFFICULTY4 0 1 2 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Bowman"            {ON_DIFFICULTY4 0 1 2 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Spearman"          {ON_DIFFICULTY4 1 2 4 4}} # including 1 guard on all difficulties
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Spearman"          {ON_DIFFICULTY4 0 1 2 2}}
    [event]
        name,first_time_only=side 4 turn,no
        {RESET_SIDE_AI 4,5,6,7 no 0.9 0.1}
    [/event]
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                    PREPARE MAP
    #######################################################################################################################################################
    [event]
        name=prestart
        #############################
        # SCENERY
        #############################
        {PLACE_IMAGE "items/boxes.png~FL()" 5 26}
        {PLACE_IMAGE "items/barrel.png"     4 25}
        {PLACE_IMAGE "items/box.png"        1 26}
        
        #############################
        # NORTH PATH
        #############################
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpling" "Giant Scorpion"  "Giant Scorpion"  "Giant Scorpion" }) 15  7 ()} # rush straight at Konrad as soon as he opens an entrance
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpling" "Giant Scorpling" "Giant Scorpling" "Giant Scorpling"}) 15  7 ()}
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpling" "Giant Scorpion"  "Giant Scorpion"  "Giant Scorpion" }) 15  7 ()}
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "none"            "none"            "Giant Scorpling" "Giant Scorpling"}) 12 16 ()}
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpling" "Giant Scorpion"  "Giant Scorpion"  "Giant Scorpion" })  6 12 ({FACING se}{ROLE scorps1}{ZONE_GUARDIAN  6 12 (radius=4 {FILTER role=scorps1})}) }
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "none"            "Giant Scorpling" "Giant Scorpling" "Giant Scorpling"})  2 12 ({FACING sw}{ROLE scorps1}{ZONE_GUARDIAN  2 12 (radius=4 {FILTER role=scorps1})}) }
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpling" "Giant Scorpion"  "Giant Scorpion"  "Giant Scorpion" })  7  7 ({FACING sw}{ROLE scorps2}{ZONE_GUARDIAN  7  7 (radius=4 {FILTER role=scorps2})}) }
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpling" "Giant Scorpling" "Giant Scorpion"  "Giant Scorpion" })  8  8 ({FACING se}{ROLE scorps2}{ZONE_GUARDIAN  8  8 (radius=4 {FILTER role=scorps2})}) }
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "none"            "none"            "Giant Scorpion"  "Giant Scorpion" })  6  8 ({FACING sw}{ROLE scorps2}{ZONE_GUARDIAN  6  8 (radius=4 {FILTER role=scorps2})}) }
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "none"            "none"            "Giant Scorpion"  "Giant Scorpion" })  5  8 ({FACING sw}{ROLE scorps2}{ZONE_GUARDIAN  5  8 (radius=4 {FILTER role=scorps2})}) }
        
        #############################
        # SOUTH PATH
        #############################
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpion"  "Giant Spider" "Giant Spider" "Giant Spider"}) 18 20 ({FACING sw}{ROLE spiders1}{ZONE_GUARDIAN 18 20 (radius=5 {FILTER role=spiders1})}) }
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpion"  "Giant Spider" "Giant Spider" "Giant Spider"}) 20 18 ({FACING se}{ROLE spiders1}{ZONE_GUARDIAN 20 18 (radius=5 {FILTER role=spiders1})}) }
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpion"  "none"         "Giant Spider" "Giant Spider"}) 21 11 ({FACING se}{ROLE spiders2}{ZONE_GUARDIAN 21 11 (radius=5 {FILTER role=spiders2})}) }
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpion"  "Giant Spider" "Giant Spider" "Giant Spider"}) 24 14 ({FACING sw}{ROLE spiders2}{ZONE_GUARDIAN 24 14 (radius=5 {FILTER role=spiders2})}) }
        {GENERIC_UNITC 2 ({ON_DIFFICULTY4 "Giant Scorpling" "none"         "Giant Spider" "Giant Spider"}) 27 11 ({FACING se}{ROLE spiders2}{ZONE_GUARDIAN 27 11 (radius=5 {FILTER role=spiders2})}) }
        
        #############################
        # ANT EGGS
        #############################
        {REPEAT ({ON_DIFFICULTY4 1 2 4 4}) ({GENERIC_UNIT 2 (Giant Ant Egg) 14  3}{PASSABLE})}
        {REPEAT ({ON_DIFFICULTY4 1 2 4 4}) ({GENERIC_UNIT 2 (Giant Ant Egg) 28  7}{PASSABLE})}
        {REPEAT ({ON_DIFFICULTY4 1 2 4 4}) ({GENERIC_UNIT 2 (Giant Ant Egg) 27  2}{PASSABLE})}
        {REPEAT ({ON_DIFFICULTY4 1 2 4 4}) ({GENERIC_UNIT 2 (Giant Ant Egg) 21  8}{PASSABLE})}
        
        #############################
        # KONRAD
        #############################
        {PUT_TO_RECALL_LIST id=Konrad}
    [/event]
    #######################################################################################################################################################
    #                                                                    PLAY SCENARIO
    #######################################################################################################################################################
    [event]
        name=start
        #############################
        # INITIAL DIALOGUE
        #############################
        [message]
            side,caption,image=2,"",none # can't use narrator, since Konrad doesn't exist yet
            message=_"<i>The last dwarvish ruin far behind them, the party descended into the deepest parts of the hewn caverns. Except for disturbances caused by the occasional rodent, the air in the lower passages was still and tomblike.</i>"
        [/message]
        [message]
            side,caption,image=2,"",none # can't use narrator, since Konrad doesn't exist yet
            message=_"<i>Stepping through a low corridor, Konrad and Delfador emerged from the maze-like catacombs into icy blackness. Darkness seemed to crush them. Lights flickered and went out. Even the staff of the elder mage struggled to produce enough light to see by.</i>"
        [/message]
        [message]
            side,caption,image=2,"",none # can't use narrator, since Konrad doesn't exist yet
            message=_"<i>A cavernous void stretched out ahead, across which no ceiling or walls were visible. Wind howled and whipped over narrow ledges bridging the depths, almost as if animated by powerful nearby magic... and newly awoken evil.</i>"
        [/message]
        
        #############################
        # KONRAD ARRIVES
        #############################
        {RECALL_XY Delfador 5 23}
        {MODIFY_UNIT id=Delfador facing sw} {REDRAW}
        {RECALL_KONRAD_AND_COMPANIONS 2 23}
        [message]
            speaker=Konrad {KONRAD_VARIATION concerned}
            message=_"Well, here we are. Delfador — other than the Sceptre, you’re not keeping any other secrets from me “for my own good”, are you?"
        [/message]
        [message]
            speaker=Delfador
            message=_"Only one, and I hope it will never have to come to light. Here and now, we must find the Sceptre. It calls out to be freed... it is near; very near! It was forged here, not far where we now stand. The sheer power of it!"
        [/message]
        {FIND_COMPANION_AND_SAY
            MESSAGE_HARPER=_"Growin’ up they used to tell me fairytales about the Sceptre... Never thought I might actually be seein’ it in person. Which way do we go, Delfador?"
            MESSAGE_MOREMIRMU=_"Yea, the hallowed fire shall bring Light to the places of darkness! So proclaim the texts, and so shall it be. Where can the Sceptre be found, scholar?"
            MESSAGE_ULFDAIN=_"’twere my people who made it fer ye humans, and ’twere my people who lost it, long ago. Now ’tis only right that I help ye get it back. Where be the Sceptre, scholar?"
            FALLBACK_KONRAD=_"Very well — then where? How do we find it?"
        }
        [message]
            speaker=Delfador
            message=_"North and east. More than that, I cannot tell. Whatever beasts, monsters, and other denizens of the dark lurk ahead, I know that we shall prevail."
        [/message]
        
        #############################
        # OBJECTIVES
        #############################
        [objectives]
            [objective]
                description= _ "Defeat the enemy leader"
                condition=win
            [/objective]
            {TURNS_RUN_OUT}
            {OBJECTIVES_HERODEATHS}
            [gold_carryover]
                carryover_percentage,bonus=0,no
            [/gold_carryover]
        [/objectives]
    [/event]
    
    #############################
    # KONRAD IS WORRIED
    #############################
    [event]
        name=turn 2
        [message]
            speaker=Konrad {KONRAD_VARIATION concerned}
            message=_"Delfador has told me the importance of the Sceptre of Fire, and I believe him. A powerful magical artifact, and the fabled symbol of the kings of Wesnoth. With the Sceptre in my hand even Asheviere would struggle to deny my claim of heirship."
        [/message]
        [message]
            speaker=Konrad {KONRAD_VARIATION concerned}
            message=_"Yet it pains me to know that while we delve deep under this mountain, countless people back home are suffering. Elves, men, dwarves; people we’ve missed out helping because we had to come here instead. I hope it’ll be worth it in the end."
        [/message]
    [/event]
    
    #############################
    # FORESHADOW HEIR
    #############################
    [event]
        name=turn 5
        [message]
            speaker=Konrad {KONRAD_VARIATION concerned}
            message=_"Delfador... other than the prophecy about the Sceptre, which you’ve now explained to me, you’re not keeping any other secrets from me “for my own good”, are you?"
        [/message]
        [message]
            speaker=Delfador
            message=_"Only one, and I hope it will never have to come to light. Here and now, we must focus on finding the Sceptre if you are to ever become king."
        [/message]
    [/event]
    
    #############################
    # REACH SCEPTRE
    #############################
    [event]
        name=moveto
        {FILTER side,x,y=1,24,7}
        {FILTER_CONDITION({NOT({HAVE_UNIT id=Lisar})})}
        [message]
            speaker=Konrad
            message=_"What a strange rock formation. Could this be the resting place of the Sceptre?"
        [/message]
        [message]
            speaker=Delfador
            message=_"It certainly might be, but we must clear out the leader of the local fauna before we can investigate further."
        [/message]
    [/event]
    
    #############################
    # TIME OVER
    #############################
    [event]
        name=side 1 turn {SCENARIO_TURN_LIMIT} end
        {FILTER_CONDITION({NOT({HAVE_UNIT id=Lisar})})}
        [message]
            speaker=Konrad {KONRAD_VARIATION concerned}
            message=_"We’ve been wandering for so long, and we still haven’t cleared our way to the Sceptre."
        [/message]
        [message]
            speaker=Konrad {KONRAD_VARIATION concerned}
            message=_"Even if it really is somewhere here, I fear it is beyond our power to obtain..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    
    #############################
    # ANT QUEEN KILLED
    #############################
    [event]
        name=die
        {FILTER id=ant_leader}
        {KILL_COUNT 5 (side=2 {NOT id=ant_leader}) ANIMATE=yes}
        {KILL side=2}
        [message]
            speaker=Delfador
            message=_"The ants are defeated, and I sense great power emanating from the chasm nearby. Everyone, gather round."
        [/message]
        {FIRE_EVENT part_two}
    [/event]
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                        PART TWO
    #######################################################################################################################################################
    [event]
        name=part_two
        
        #############################
        # REPLACE MAP
        #############################
        {SCREEN_FADER 0,0,0 255 500}
        {REMOVE_IMAGE 0-99 0-99}
        {FADE_MUSIC_OUT 500}
        
        [store_unit]
            {FILTER()}
            variable=stored_s30_units
        [/store_unit]
        [replace_map]
            map_file=30b_The_Sceptre_of_Fire.map
            expand,shrink=yes,yes
        [/replace_map]
        [foreach]
            array=stored_s30_units
            [do]
                {VARIABLE this_item.x "$( $this_item.x - 4 )"}
                {VARIABLE this_item.y "$( $this_item.y + 9 )"}
                [unstore_unit]
                    variable=this_item
                    find_vacant=yes
                    check_passability=yes
                [/unstore_unit]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE stored_s30_units}
        {GOLD_PICKUP 40 13 items/gold-coins-medium.png 55 _"55 gold" _"Li’sar’s soldiers have stockpiled some gold here! We’ll put it to better use."}
        
        #############################
        # MOVE UNITS
        #############################
        # move Konrad, Delfador, and all your other units
        {TELEPORT_UNIT id=Konrad   21 14} {MODIFY_UNIT id=Konrad facing sw} 
        {TELEPORT_UNIT (side=1 {NOT id=Delfador}) 19 13}
        {TELEPORT_UNIT id=Delfador 17 16} {MODIFY_UNIT id=Delfador facing ne} 
        
        # move a couple of our other units to various different hexes, so they're less obviously clumped up
        {TELEPORT_TILE 18 12  23 13}
        {TELEPORT_TILE 19 12  24 16}
        
        # refresh shroud
        [place_shroud]
            side=1
            x,y=0-99,0-99
        [/place_shroud]
        {REDRAW}
        
        {FADE_MUSIC_IN 0}
        {SCREEN_FADER 0,0,0 000 500}
        
        #############################
        # INTRODUCE SCEPTRE
        #############################
        [message]
            speaker=Delfador
            message=_"We are here. The Sceptre... the earth... the fire... the air around us... everything! It calls out to be freed — I can barely hold it back in my mind."
        [/message]
        {FIND_COMPANION_AND_SAY
            MESSAGE_HARPER=_"Err... is this one o’ those confusing wizard things? Th’ cave looks pretty empty to me. Where’s the Sceptre?"
            MESSAGE_MOREMIRMU=_"Yea, truly there is a strangeness in the air here... not of the Light, but of something else entirely. But where is the source?"
            MESSAGE_ULFDAIN=_"Aye, tha’s nice... except there’s nothin’ here, ye cloud-headed blunderbuss! It’s bare cave!"
            FALLBACK_KONRAD=_"But where is it? I don’t see a thing!"
        }
        [message]
            speaker=Delfador
            message=_"My research suggests that we stand in the center of a dormant volcano, which erupted centuries ago and buried the Sceptre in rock."
        [/message]
        {MOVE_UNIT id=Delfador 19 17}
        {ANIMATE_ATTACK id=Delfador range=ranged yes x,y=20,16} {SOUND golem-crush-original.wav}
        [event]
            name=side 1 turn refresh
            first_time_only=no
            {MODIFY_UNIT id=Delfador moves 0}
            {MODIFY_UNIT id=Delfador facing ne}
            {ANIMATE_ATTACK id=Delfador range=ranged yes x,y=20,16}
            {SOUND golem-crush-original.wav}
        [/event]
        [message]
            speaker=Delfador
            message=_"I shall have to use my magic to dig it out. This may take some time, Konrad."
        [/message]
        {ANIMATE_ATTACK id=Delfador range=ranged yes x,y=20,16} {SOUND golem-crush-original.wav} {DELAY 500}
        {ANIMATE_ATTACK id=Delfador range=ranged yes x,y=20,16} {SOUND golem-crush-original.wav} {DELAY 500}
        {ANIMATE_ATTACK id=Delfador range=ranged yes x,y=20,16} {SOUND golem-crush-original.wav} {DELAY 500}
        
        #############################
        # INTRODUCE LISAR
        #############################
        {REPLACE_SCENARIO_MUSIC primal-carnage.ogg}
        {APPEND_MUSIC siege_of_laurelmor.ogg}
        {APPEND_MUSIC juggernaut.ogg}
        
        {DELAY 500}
        {UNSTORE_NPC Lisar x,y=1,28 side,facing=4,ne}
        [capture_village]
            side,x,y,radius=4,8,25,6
        [/capture_village]
        [capture_village]
            side,x,y,radius=6,40,14,7
        [/capture_village]
        {REVEAL x,y,radius=2,27,2}
        {SCROLL_TO 2 27}
        {DELAY 500}
        [message]
            speaker=Lisar {LISAR_VARIATION mad}
            message=_"A sound like that can only mean one thing: my cousin and his handler have reached the Sceptre of Fire."
        [/message]
        {MOVE_UNIT id=Lisar 6 25}
        {MODIFY_TERRAIN Ke 6 25} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce 7 26} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce 7 25} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce 6 24} {REDRAW} {DELAY 150}
        {MODIFY_TERRAIN Ce 5 25} {REDRAW} {DELAY 150}
        {GENERIC_UNIT 4 ({ON_DIFFICULTY4 "Heavy Infantryman" "Heavy Infantryman" "Shock Trooper" "Shock Trooper"}) 7 26} {ANIMATE}
        {GENERIC_UNIT 4 ({ON_DIFFICULTY4 "Fencer"            "Fencer"            "Duelist"       "Duelist"      }) 7 25} {ANIMATE}
        {GENERIC_UNIT 4 ({ON_DIFFICULTY4 "Heavy Infantryman" "Shock Trooper"     "Shock Trooper" "Shock Trooper"}) 6 24} {ANIMATE}
        {UNSTORE_NPC Mirya x,y=5,25 side=4}
        [message]
            speaker=Lisar {LISAR_VARIATION mad}
            message=_"Loyalists, this is it. Within these caves lurks my usurping cousin; the false prince; the puppet of Delfador."
        [/message]
        
        #############################
        # LISAR SPEECH
        #############################
        # build a speech for Li'sar that references events specific to this playthrough
        {VARIABLE phrase_count 0}
#define BUILD_SPEECH SNUM MESSAGE
        [if]
            {VARIABLE_CONDITIONAL {SNUM}_status equals completed}
            {VARIABLE_CONDITIONAL phrase_count less_than 3}
        {THEN(
            [if]{VARIABLE_CONDITIONAL phrase_count equals 0}
                {THEN( {VARIABLE lisar_speech "{MESSAGE}"}                )}
                {ELSE( {VARIABLE lisar_speech "$lisar_speech, {MESSAGE}"} )}
            [/if]
            {VARIABLE_OP phrase_count add 1}
        )} [/if]
#enddef
        {BUILD_SPEECH s10 _"Elensefar rebelling under Maddock"}
        {BUILD_SPEECH s11 _"Elensefar ruled by thieves"}
        {BUILD_SPEECH s13 _"our stores pillaged at Fort Tahn"}
        {BUILD_SPEECH s13 _"convoys burning outside Dan’Tonk"}
        {BUILD_SPEECH s07 _"massacred, zombified townsfolk at the peninsula"}
        {BUILD_SPEECH s26 _"dead slaves at the Dwarven Doors"}
        {BUILD_SPEECH s06 _"libraries burning at Alduin"}
        {BUILD_SPEECH s05 _"riots at the Bay of Pearls"}
        {BUILD_SPEECH s03 _"rebels at Blackwater Port"}
        {BUILD_SPEECH s02 _"elvish criminals escaping into the south"}
        {BUILD_SPEECH s22 _"trouble with the orcs at Glamdrol"}
        {BUILD_SPEECH s20 _"corpses clogging up the Ford"}
        {BUILD_SPEECH s14 _"blood-stained slopes on Gryphon Mountain"}
        [if] {VARIABLE_CONDITIONAL lisar_speech.length greater_than 0} {THEN({VARIABLE lisar_speech _"$lisar_speech... "})} [/if]
        [message]
            speaker=Lisar {LISAR_VARIATION mad}
            #po: several of the strings above are joined to create $lisar_speech.
            #po: For example, this message might read something like "in his wake: dead slaves at the Dwarven Doors, massacred, zombified townsfolk at the peninsula... Today, we put a stop to it."
            #po: If translating a dynamic string like this is difficult or impossible in your language, $lisar_speech can be removed entirely
            message=_"You have heard the blood and chaos that follows in his wake: $lisar_speechToday, we put a stop to it."
        [/message]
        {CLEAR_VARIABLE phrase_count,lisar_speech}
        
        #############################
        # INTRODUCE ENEMY LEADERS
        #############################
        # northwest
        {UNSTORE_NPC Warven x,y=6,3 side,facing=5,se}
        {GENERIC_UNIT 5 "Swordsman" 11 5} {FACING sw} {GUARDIAN}
        {GENERIC_UNIT 5 "Spearman"  5  8} {FACING ne} {GUARDIAN}
        {GENERIC_UNIT 5 "Spearman"  8  3} {FACING se} {GUARDIAN}
        [capture_village]
            side,x,y,radius=5,7,4,8}
        [/capture_village]
        {REVEAL x,y,radius=7,5,4}
        [message]
            speaker=Warven
            message=_"Northern company reporting, ma’am. We’re in position."
        [/message]
        
        # southeast
        {NAMED_UNIT 6 "Red Mage"   42 24 leader6 _"Yrridyn" ()} {LEADER} {FACING sw}
        {GENERIC_UNIT 6 "Mage"     38 26} {FACING sw} {GUARDIAN}
        {GENERIC_UNIT 6 "Spearman" 39 30} {FACING ne} {GUARDIAN}
        {GENERIC_UNIT 6 "Mage"     42 26} {FACING se} {GUARDIAN}
        [capture_village]
            side,x,y,radius=6,37,27,7
        [/capture_village]
        {REVEAL x,y,radius=40,26,4}
        [message]
            speaker=leader6
            message=_"I have the eastern tunnels locked down. Ready to move in."
        [/message]
        
        # northeast
        {NAMED_UNIT 7 "Longbowman" 39  5 leader7 _"Arynnoc" ()} {LEADER} {FACING sw}
        {GENERIC_UNIT 7 "Bowman"   32  3} {FACING se} {GUARDIAN}
        {GENERIC_UNIT 7 "Bowman"   37  7} {FACING ne} {GUARDIAN}
        {GENERIC_UNIT 7 "Bowman"   39 15} {FACING sw} {GUARDIAN}
        [capture_village]
            side,x,y,radius=6,36,4,7
        [/capture_village]
        {REVEAL x,y,radius=40,26,4}
        [message]
            speaker=leader7
            message=_"Ready and waiting. They won’t get past us, your highness."
        [/message]
        
        #############################
        # MIRYA TELEPORTS AWAY
        #############################
        [message]
            speaker=Lisar
            message=_"Good. Konrad must not escape these caverns with the Sceptre of Fire. And Mirya — if things go bad, you know what to do."
        [/message]
        {MOVE_UNIT id=Mirya 2 24}
        {ANIMATE_UNIT id=Mirya pre_teleport}
        {STORE_NPC Mirya}
        
        # refresh shroud
        [place_shroud]
            side=1
            x,y=0-99,0-99
        [/place_shroud]
        {REDRAW}
        
        # show sides
        [modify_side]
            side=2,3
            hidden=yes
        [/modify_side]
        [modify_side]
            side=4,5,6,7
            hidden=no
        [/modify_side]
        
        #############################
        # OBJECTIVES
        #############################
        [objectives]
            [objective]
                caption= _ "Cowardly:"
                description= _ "Move Konrad to the northeastern cave exit"
                condition=win
            [/objective]
            [objective]
                caption= _ "Normal:"
                description= _ "Protect Delfador until he unearths the sceptre"
                condition=win
                show_turn_counter=yes
            [/objective]
            [objective]
                caption= _ "Heroic:"
                description= _ "Defeat Li’sar"+{OBJECTIVE_FOOTNOTE _"(bonus reward)"}
                condition=win
            [/objective]
            {OBJECTIVES_HERODEATHS}
            [gold_carryover]
                carryover_percentage,bonus=40,no
            [/gold_carryover]
        [/objectives]
        
        
        
        #############################
        # KONRAD AND LISAR DISCUSS
        #############################
        [event]
            name=new turn
            
        [/event]
        
        
        
        
        #######################################################################################################################################################
        #                                                                    VICTORY / DEFEAT
        #######################################################################################################################################################
    [/event]
[/scenario]

#undef SCENARIO_TURN_LIMIT
#undef WESNOTH_SIDE
#undef BUILD_SPEECH
