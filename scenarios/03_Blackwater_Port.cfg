#textdomain wesnoth-httt

[scenario]
    id=03_Blackwater_Port
    name= _ "scenario name^Blackwater Port"
    next_scenario=00_The_Great_Continent
    map_file=03_Blackwater_Port.map
    {SCHEDULE_DYNAMIC $current_time}
    turns={ON_DIFFICULTY4 12 12 12 12}

    {SCENARIO_MUSIC "loyalists.ogg"}
    {EXTRA_SCENARIO_MUSIC "knolls.ogg"}
    {EXTRA_SCENARIO_MUSIC "breaking_the_chains.ogg"}
    {EXTRA_SCENARIO_MUSIC "wanderer.ogg"}
    {EXTRA_SCENARIO_MUSIC "battle.ogg"}

    [event]
        name=prestart
        [objectives]
            side=1
            [objective]
                description= _ "Resist until the end of the turns"
                condition=win
                show_turn_counter=yes
            [/objective]
            [objective]
                {BONUS_OBJECTIVE_CAPTION}
                description= _ "Protect Sir Kaylan (to get full scenario reward.)"
                [show_if] {HAVE_UNIT id=Kaylan} [/show_if]
                condition=win
            [/objective]
            [objective]
                {ALTERNATIVE_OBJECTIVE_CAPTION}
                description= _ "Defeat the enemy leaders"+{EARLY_FINISH_BONUS_FOOTNOTE}+{OBJECTIVE_FOOTNOTE _"(special bonus)"}
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Konrad"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Delfador"
                [show_if] {HAVE_UNIT id=Delfador} [/show_if]
                condition=lose
            [/objective]
            [gold_carryover]
                carryover_percentage=40
            [/gold_carryover]
            [note]
                description=_"If Sir Kaylan dies, you will not get Horsemen and Cavalrymen, only Peasants and Woodsmen."
            [/note]
        [/objectives]
    [/event]

    #TODO: uncomment the story text when the actual story gets added

    #{HTTT_TRACK {JOURNEY_02_NEW} }

    {KONRAD_SIDE {ON_DIFFICULTY4 100 80 65 50}}

    [side]
        type=Grand Knight
        id=Kaylan
        name= _ "Sir Kaylan"
        profile=portraits/humans/grand-knight-2.webp

        side=2
        # Make Kaylan's TC teal, so it fits better with the portrait.
        color=teal
        canrecruit=yes
        team_name=konrad
        user_team_name=_"Rebels"
        recruit=Horseman
        [ai]
            recruitment_pattern=fighter
            villages_per_scout=0
        [/ai]
        [ai]
            time_of_day=dusk,first_watch,second_watch
            aggression=0.45
            grouping=defensive
        [/ai]
        gold,income={ON_DIFFICULTY4 40 60 80 100},0
    [/side]
    #Kaylan can move 2 tiles per turn, not too fast but not completely immobile
    {SILENTLY_LIMIT_LEADER_MOVES 2 2}

    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Knight" 1}

    {STARTING_VILLAGES_AREA 2 12 8 5}

    [side]
        type=Lieutenant
        #TODO: maybe add some name to the enemy leader?
        id=enemy1
        name= _ "TODOius the Unfinished"
        side=3
        color=purple
        canrecruit=yes
        team_name=enemies
        user_team_name=_"Army of Wesnoth"
        recruit=Spearman,Bowman,Cavalryman
        gold,income={ON_DIFFICULTY4 40 60 80 100},{ON_DIFFICULTY4 -2 0 2 4}
        {FLAG_VARIANT loyalist}
    [/side]
    #lieutenant enemy is pretty fragile, so only 1 move per turn
    {SILENTLY_LIMIT_LEADER_MOVES 3 1}

    {STARTING_VILLAGES_AREA 3 29 7 5}

    [side]
        type=Pikeman
        #TODO: maybe add some name to the enemy leader?
        id=enemy2
        name= _ "TODOius the Unfinished"
        side=4
        color=purple
        canrecruit=yes
        team_name=enemies
        user_team_name=_"Army of Wesnoth"
        recruit=Spearman,Bowman,Cavalryman
        gold,income={ON_DIFFICULTY4 40 60 80 100},{ON_DIFFICULTY4 -2 0 2 4}
        {FLAG_VARIANT loyalist}
    [/side]
    #pikeman only moves up to 2 tiles to heal in village/attack if necessary
    {SILENTLY_LIMIT_LEADER_MOVES 4 2}

    {STARTING_VILLAGES_AREA 4 21 14 2}

    [side]
        type=Orcish Warrior
        id=Mokolo Qimur
        name= _ "Mokolo Qimur"
        profile=portraits/orcs/grunt-2.webp
        side=5
        color=black
        canrecruit=yes
        team_name=enemies
        user_team_name=_"Blackcrest Clan"
        recruit=Orcish Grunt,Orcish Archer,Troll Whelp
        #note: when balancing gold, keep in mind orcs arrive towards Kaylan's troops when it's nighttime, so they have an advantage compared to loyalists
        gold,income={ON_DIFFICULTY4 30 45 60 75},{ON_DIFFICULTY4 -2 0 2 4}
        {FLAG_VARIANT6 ragged}
    [/side]

    #orcs are too far to really need a silently_limit_leader macro, and the leader can just be more aggressive than average anyway

    {STARTING_VILLAGES_AREA 5 1 18 7}

    [event]
        name=prestart

        {PLACE_IMAGE items/dwarven-keep-tile.png 29 7}

        {BRAIZER_DYNAMIC 10 7 $current_time}
        {BRAIZER_DYNAMIC 8 10 $current_time}
        {BRAIZER_DYNAMIC 15 10 $current_time}
        {BRAIZER_DYNAMIC 26 8 $current_time}

        {GENERIC_UNIT 2 (Spearman) 18 11} {FACING se} {GENDER male} {ZONE_GUARDIAN 18 11 x,y,radius=12,8,7}
        {GENERIC_UNIT 2 (Spearman) 14 12} {FACING se} {GENDER male} {ZONE_GUARDIAN 14 12 x,y,radius=12,8,7}
        {GENERIC_UNIT 2 (Spearman) 10 11} {FACING sw} {GENDER male} {ZONE_GUARDIAN 10 11 x,y,radius=12,8,7}

        {GENERIC_UNIT 3 (Spearman) 23 10} {FACING sw} {GENDER male} {ZONE_GUARDIAN 23 10 x,y,radius=29,7,7}
        {GENERIC_UNIT 3 (Shock Trooper) 27 10} {FACING sw} {GENDER male} {ZONE_GUARDIAN 27 10 x,y,radius=29,7,5}

        #make AI prioritize Kaylan instead of Konrad first

        {MODIFY_AI_ADD_GOAL 3 (
            {GOAL_SEEK_SIDE 20 2 0}
        )}

        {MODIFY_AI_ADD_GOAL 4 (
            {GOAL_SEEK_SIDE 20 2 0}
        )}

        {RECALL_KONRAD_AND_COMPANIONS 33 20}
    [/event]

    [event]
        name=start
        [message]
            speaker,image=Konrad,portraits/konrad-elvish-concerned.webp
            message= _ "Uncle Kaylan, we're here! Are you alright? What can I do to help?"
        [/message]
        [if] {HAVE_UNIT id=Delfador} {THEN(
        [message]
            speaker=Kaylan
            message= _ "Welcome, young Konrad and Delfador! It is an honor to once again lay eyes upon the true heir of Wesnoth. The false queen's forces have caught us unprepared, but my riders shall soon arrive to rout the enemy!"
        [/message]
        #foreshadow Delfador leaving
        [message]
            speaker=Delfador
            message= _ "How soon, Kaylan? I suspect Elensefar to be under siege as well - I cannot leave Maddock to fight alone, yet neither can I leave the prince unguarded."
        [/message]
        )} {ELSE (
        [message]
            speaker=Kaylan
            message= _ "Welcome, young Konrad! It is an honor to once again lay eyes upon the true heir of Wesnoth. The false queen's forces have caught us unprepared, but my riders shall soon arrive to rout the enemy!"
        [/message]
        )}
        [/if]
        [message]
            speaker=Kaylan
            message= _ "If we can hold Blackwater for just a few more days, victory shall be assured! I am encircled and trapped in the port, while many stout farmers are trapped outside, leaderless - you must rouse the peasants from the outlying farms, and lead them in defense of their homes! Hearken to my words, Konrad, and Blackwater Port shall yet endure!"
        [/message]
        [if] {HAVE_UNIT id=Delfador} {THEN(
        [message]
            speaker=Delfador
            {DELFADOR_MENTORING}
            message= _ "Rallying the peasants will be a good opportunity to apply the lessons I taught you about leadership. Soon you will need to rely only your own skills and on your own troops. Even a simple peasant can eventually become a competent soldier."
        [/message]
        )} 
        [/if]
        [message]
            speaker=Konrad
            message= _ "Very well, I'll make sure to do that."
        [/message]

        #giving the player a peasant that is close to leveling, with good traits to be a spearman

        [unit]
            type=Peasant
            x=31
            y=17
            id=s3_peasant
            name= _ "TODOius the Unfinished"
            side=1
            experience=11
            animate=yes
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]

        [message]
            speaker=s3_peasant
            message= _ "Are you... Prince Konrad himself?"
        [/message]
        [message]
            speaker=Konrad
            message= _ "Yeah, that's me."
        [/message]
        [message]
            speaker=s3_peasant
            message= _ "By the Lords of Light, we are saved! The rightful heir is here! Many of us common folk are fed up with the queen's reign, so we'll gladly help you reclaim your throne."
        [/message]
        [message]
            speaker=Konrad
            message= _ "Wow, these humans really like me..."
        [/message]
        [message]
            speaker=s3_peasant
            message= _ "Huh?"
        [/message]
        [message]
            speaker=Konrad
            message= _ "I mean, thank you, friend! It would be my honor to lead you and yours in defense of the port!"
        [/message]
        [message]
            speaker=s3_peasant
            #po: this is a humorous justification for why the peasant gets a lot of xp at start (11 xp is 3 attacks plus 1 kill against a lvl1 enemy)
            message= _ "I'm ready to stab your foes, Your Highness! Just like I stabbed that filthy tax collector the queen sent. He won't be robbing the poor ever again."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "You can now recruit Peasants and Woodsmen."
        [/message]
        #Blackwater Port early reward, regardless of outcome
        [allow_recruit]
            side=1
            type=Peasant,Woodsman
        [/allow_recruit]
    [/event]

    [event]
        name=turn 5
        #only trigger dialog if Kaylan is still alive
        [if]
        {VARIABLE_CONDITIONAL bm_kaylan_dead not_equals yes}
        [then]

        [message]
            speaker=Kaylan
            message= _ "Brothers-in-arms, fighting side-by-side! Not since the death of the old king have I felt this way, young Konrad. If I have but one regret in my life, it is that I could not raise you as my own."
        [/message]
        [message]
            speaker=Konrad
            message= _ "Master Delfador told me. You wanted to raise me in Blackwater Port among other humans, but Delfador felt it was too dangerous. I don't mind though. I like elves, and we still came to visit you sometimes."
        [/message]
        [if]
        {HAVE_UNIT id=Delfador}
        [then]
        [message]
            speaker=Delfador
            message= _ "And I was quite right too. A military town is no place for a young child; Blackwater Port has seen it's fair share of battles since I first rescued you, Konrad."
        [/message]
        [/then]
        [/if]

        [/then]
        [/if]
    [/event]

    #old dialog to use as a reference:

    [event]
#        name=start
        name=start_unused
        [message]
            speaker=Delfador
            message= _ "We should be able to board a ship at Blackwater Port, but it seems the orcs are heading there too. Rebels who hate Asheviere and are loyal to the memory of the king desperately hold the port, as it is one of the only places where they can ship supplies and weapons."
        [/message]
        [message]
            speaker=Konrad
            message= _ "Delfador, some orcs are following us! We must make haste!"
        [/message]
        [message]
            speaker=Kaylan
            message= _ "Delfador, my old friend! We had heard of your coming, and of the attacks on the elves. It is good to see you again, although I would prefer it were not in such sad times."
        [/message]
        [message]
            speaker=Delfador
            message= _ "Konrad, this is Kaylan, one of the mightiest of the horse lords, and one of the few who is willing to oppose the Dark Crown. Rumor has it that his lance has slain fifty men and a hundred orcs."
        [/message]
        [message]
            speaker=Kaylan
            message= _ "It seems the orcs have come here too, to try to wrest this port from our hands. Our defenses are still weak, but reinforcements will arrive soon!"
        [/message]
        [message]
            speaker=Konrad
            message= _ "We will help you fight them off until the reinforcements arrive."
        [/message]
        [message]
            speaker=Kaylan
            message= _ "With your help, we have hope we can fend them off. But you must not tarry here long, for your survival is even more important to our cause than the strength of the port. A ship is due here in two days, surely it will be able to take you to safety."
        [/message]
        [message]
            speaker=Konrad
            message= _ "And the ship will take us to Alduin?"
        [/message]
        [message]
            speaker=Delfador
            message= _ "Yes, we will sail to the Isle of Alduin, my home, Konrad, and the home of many magi."
        [/message]
        [message]
            speaker=Kaylan
            message= _ "I will send one of my horsemen to serve under you. I offer you my support, Konrad, and the support of my men — from now on you will be able to recruit horsemen."
        [/message]
        #   [message]
        #   speaker=narrator
        #   image="wesnoth-icon.png"
        #   message= _ "You may now recruit horsemen!"
        #   [/message]
        [message]
            speaker=Konrad
            message= _ "Thank you, sir. But how shall I best use these horsemen? How do they differ from elves?"
        [/message]
#ifdef EASY
        [message]
            speaker=Kaylan
            message= _ "Elves are a powerful race, Konrad, more powerful than my own people usually acknowledge. But horsemen are powerful in a different way. They have no long range attack, but can charge into combat, inflicting double normal damage, though taking double damage in return. They are also lawful, meaning they fight better by day, and worse at night. Horsemen are unmatched on open land, though elves will serve you better in forests or rugged terrain."
        [/message]
#else
        [message]
            speaker=Kaylan
            message= _ "Elves may be the lords of the forest, but horsemen are powerful as well. On the plains under the midday sun they can fell the toughest foes with sharp spears and under heavy hoofs!"
        [/message]
#endif
        [message]
            speaker=Delfador
            {DELFADOR_MENTORING_ELF}
            message= _ "Recruit troops wisely, Konrad, and remember that you can recall experienced units from past battles to help you fight again."
        [/message]
        [move_unit_fake]
            side=1
            type=Horseman
            x=15,16,23
            y=27,27,24
        [/move_unit_fake]
        [unit]
            id=Haldiel
            name= _ "Haldiel"
            type=Horseman
            x=23
            y=24
            side=1
            facing=ne
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        [message]
            speaker=Haldiel
            message= _ "Greetings, young master. I pledge myself to your service."
        [/message]
        [message]
            speaker=Delfador
            {DELFADOR_MENTORING_ELF}
            message= _ "Konrad, note that Haldiel does not seek gold upkeep; as a loyal unit he fights for us solely out of loyalty to our cause. Such units are extremely valuable. Take care to use them cautiously in battle, lest they fall."
        [/message]
    [/event]


    [event]
        name=attack end
        [filter_second]
            id=Kaylan
        [/filter_second]

        [message]
            speaker=Kaylan
            message= _ "Asheviere's troops are breaking through our defenses! Veocyn, Yran, hold the line!"
        [/message]

        [unit]
            type=Swordsman
            x=$unit.x
            y=$unit.y
            id=Veocyn
            name= _ "Veocyn"
            side=2
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type=Swordsman
            x=$unit.x
            y=$unit.y
            id=Yran
            name= _ "Yran"
            side=2
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]

        [message]
            speaker=Veocyn
            message= _ "Sir yes sir!"
        [/message]
    [/event]

    #note: should be close to when the turns run out, a small group of reinforcements arrives early:

    [event]
        name=turn 10
        [scroll_to]
            x=20
            y=20
        [/scroll_to]
        [unit]
            type=Horseman
            id=Vygwyn
            name= _ "Vygwyn"
            x=18
            y=20
            side=2
            facing=ne
            animate=yes
            random_traits=yes
        [/unit]
        [unit]
            type=Cavalryman
            id=Gaebryn
            name= _ "Gaebryn"
            x=20
            y=20
            side=2
            facing=ne
            animate=yes
            random_traits=yes
        [/unit]

        #TODO: maybe improve the dialog here later? for now putting this as a good-enough placeholder

        [message]
            speaker=Vygwyn
            message= _ "We rode as fast as we could! The others will arrive soon, just keep holding the port!"
        [/message]
    [/event]

    #moved the reinforcements into a fire-able custom event to avoid duplicating code, unlike the original

    [event]
        name=s3_reinforcements
        [scroll_to]
            x=20
            y=20
        [/scroll_to]
        [unit]
            type=Horseman
            id=Yredd
            name= _ "Yredd"
            x=16
            y=20
            side=2
            facing=ne
            animate=yes
            random_traits=yes
        [/unit]
        [unit]
            type=Dragoon
            id=Tarcyn
            name= _ "Tarcyn"
            x=20
            y=20
            side=2
            facing=ne
            animate=yes
            random_traits=yes
        [/unit]
        [unit]
            type=Knight
            id=Syryn
            name= _ "Syryn"
            x=24
            y=20
            side=2
            facing=ne
            animate=yes
            random_traits=yes
        [/unit]
        [unit]
            type=Knight
            id=Cicyn
            name= _ "Cicyn"
            x=21
            y=20
            side=2
            facing=ne
            animate=yes
            random_traits=yes
        [/unit]
        [unit]
            type=Knight
            id=Ginvan
            name= _ "Ginvan"
            x=17
            y=20
            side=2
            facing=ne
            animate=yes
            random_traits=yes
        [/unit]
        #Haldiel/Simyr given to the player as high-xp horsemen if the player kills all leaders, otherwise they are just here for the cutscene
        [unit]
            id=Haldiel
            name= _ "Haldiel"
            type=Horseman
            x=18
            y=19
            side=2
            facing=ne
            animate=yes
            experience=30
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [unit]
            type=Horseman
            id=Simyr
            name= _ "Simyr"
            x=22
            y=19
            side=2
            facing=ne
            animate=yes
            experience=30
            [modifications]
                {TRAIT_RESILIENT}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]

        #a few random name/traitless troops to make the reinforcements feel more like something that can wipe out the remaining enemies with ease, and to show that Kaylan can afford to give some troops to Konrad
        [unit]
            type=Horseman
            generate_name=yes
            random_traits=yes
            x=23
            y=20
            side=2
            facing=ne
            animate=yes
        [/unit]
        [unit]
            type=Cavalryman
            generate_name=yes
            random_traits=yes
            x=23
            y=20
            side=2
            facing=ne
            animate=yes
        [/unit]
        [unit]
            type=Horseman
            generate_name=yes
            random_traits=yes
            x=19
            y=20
            side=2
            facing=ne
            animate=yes
        [/unit]
        [unit]
            type=Cavalryman
            generate_name=yes
            random_traits=yes
            x=18
            y=20
            side=2
            facing=ne
            animate=yes
        [/unit]
    [/event]

    [event]
        name=time over

        [fire_event]
            name=s3_reinforcements
        [/fire_event]

        [if]
        {VARIABLE_CONDITIONAL bm_kaylan_dead equals yes}
        [then]
            #TODO: add dialog from horsemen if Kaylan is dead
        [/then]
        [else]
        [message]
            speaker=Kaylan
            message= _ "Reinforcements have arrived! Forward, men! I expect each of you to bring me back the head of an orc!"
        [/message]
        [/else]
        [/if]

        [if]
        {HAVE_UNIT (id=Mokolo Qimur)}
        [then]
        [message]
            speaker=Mokolo Qimur
            message= _ "So many foul humans riding on horses! I didn't sign up for dealing with that much. Quick, we must make our escape!"
        [/message]
        [/then]
        [/if]
        {CUTSCENE_ENEMIES_RETREAT 5 1 20}
        [if]
        {HAVE_UNIT id=enemy1}
        [then]
        [message]
            speaker=enemy1
            message= _ "Damn it, we are losing! Men, retreat!"
        [/message]
        [/then]
        [/if]
        {CUTSCENE_ENEMIES_RETREAT 3 34 9}
        [if]
        {HAVE_UNIT id=enemy2}
        [then]
        [message]
            speaker=enemy2
            message= _ "Retreat!"
        [/message]
        [/then]
        [/if]
        {CUTSCENE_ENEMIES_RETREAT 4 34 9}
        [fire_event]
            name=victory dance
        [/fire_event]
        [endlevel]
            result=victory
            bonus=no
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
        name=enemies defeated
        [fire_event]
            name=s3_reinforcements
        [/fire_event]
        [if]
        {VARIABLE_CONDITIONAL bm_kaylan_dead equals yes}
        [then]
            #TODO: add dialog from horsemen if Kaylan is dead
        [/then]
        [else]
        [message]
            speaker=Kaylan
            message= _ "Reinforcements have arrived, but lo! Together we have already managed to repel the false queen's attack. With the invading force so thoroughly defeated, I can afford to give you more troops than even originally planned."
        [/message]
        [message]
            speaker=Kaylan
            message= _ "I place two of my city’s finest horsemen in your service. Haldiel, Simyr, step forward. I place your lances in the service of young Prince Konrad here. May you help him restore order to the country."
        [/message]
        [/else]
        [/if]

        {MODIFY_UNIT id=Haldiel side 1}
        {MODIFY_UNIT id=Simyr side 1}
        {MOVE_UNIT id=Haldiel 30 18}
        {MOVE_UNIT id=Simyr 29 19}
        [message]
            speaker=Haldiel
            message= _ "Greetings, young master. I pledge myself to your service."
        [/message]
        [message]
            speaker=Simyr
            message= _ "It is my pleasure and honor to serve, my liege."
        [/message]

        [fire_event]
            name=victory dance
        [/fire_event]
        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]

    [event]
        name=victory dance

        [if]
        {VARIABLE_CONDITIONAL bm_kaylan_dead equals yes}
        [then]
        [message]
            speaker,image=Konrad,portraits/konrad-elvish-concerned.webp
            message=_"TODO: sad dialog about Kaylan's death"
        [/message]
        [/then]
        [else]
        [message]
            speaker=Kaylan
            message= _ "Thank you for the help, friends."
        [/message]

        [message]
            speaker=Delfador
            message= _ "Konrad, with the port back in our hands, you will be able to sail to the Isle of Alduin, my home, and the home of many magi."
        [/message]
        [message]
            speaker=Kaylan
            message= _ "If we manage to repel the dark queen's forces, I will send my men to serve under you on in future battles. 

            I will send one of my horsemen to serve under you. I offer you my support, Konrad, and the support of my men — from now on you will be able to recruit horsemen."
        [/message]
        #   [message]
        #   speaker=narrator
        #   image="wesnoth-icon.png"
        #   message= _ "You may now recruit horsemen!"
        #   [/message]
        [message]
            speaker=Konrad
            message= _ "Thank you, sir. But how shall I best use these horsemen? How do they differ from elves?"
        [/message]


        [message]
            speaker=Delfador
            message= _ "We should embark soon."
        [/message]
        [message]
            speaker=Kaylan
            message= _ "Safe voyage to you, friends. Rest assured that we will never surrender to the forces of the Dark Queen."
        [/message]

        #Blackwater Port reward:
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "You can now recruit Horsemen and Cavalrymen."
        [/message]
        [allow_recruit]
            side=1
            type=Horseman,Cavalryman
        [/allow_recruit]
        [/else]
        [/if]
    [/event]

    #
    # Death event for Sir Kaylan
    #
    [event]
        name=last breath
        [filter]
            id=Kaylan
        [/filter]
        [message]
            speaker=unit
            message= _ "I have failed in my duty to protect the Rightful Heir and the port."
        [/message]

        [if] {HAVE_UNIT id=Delfador} {THEN(

        [message]
            speaker=Delfador
            message= _ "TODO"
        [/message]

        )}
        {ELSE(

        [message]
            speaker=Konrad
            message= _ "TODO"
        [/message]

        )}[/if]

        {VARIABLE bm_kaylan_dead yes}

    [/event]
[/scenario]
