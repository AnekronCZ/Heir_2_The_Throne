#textdomain wesnoth-h2tt
# scenario by Dalas

#define SCENARIO_TURN_LIMIT
50#enddef

#define TOD_OFFSET
-1#enddef

[scenario]
    id,map_file,name=10_Elensefar_Before,10_Elensefar_Before.map,_"The Siege of Elensefar"
    next_scenario,victory_when_enemies_defeated=00_The_Great_Continent,no
    {SCHEDULE_DYNAMIC_DAY OFFSET={TOD_OFFSET}}
    turns={SCENARIO_TURN_LIMIT}
          {SCENARIO_MUSIC loyalists.ogg}
    {EXTRA_SCENARIO_MUSIC hunted.ogg}
    
    
    #######################################################################################################################################################
    #                                                                   DEFINE SIDES
    #######################################################################################################################################################
    {KONRAD_SIDE 75}
    
    #############################
    # ELENSEFAR
    #############################
    [event] name=prestart {UNSTORE_NPC Maddock x,y=19,18 side,facing=2,se} [/event]
    [side]
        side,controller,color=2,ai,teal
        recruit=Swordsman,Pikeman
        gold,income={ON_DIFFICULTY4 75 100 125 125},{ON_DIFFICULTY4 6 8 10 10} # plus ~5 villages, which will all be used for upkeep
        no_leader,team_name,user_team_name=yes,konrad,_"Elensefar"
        {FLAG_VARIANT6 ragged}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 2 1}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 2 "Thief" {ON_DIFFICULTY4 2 2 3 3}}
    {STARTING_VILLAGES_AREA 2 22 21 4}
    {STARTING_VILLAGES_AREA 2 28 18 3}
    
    [event] name=prestart {UNSTORE_NPC Delfador x,y=17,19 side,facing=3,se} [/event]
    [side]
        side,controller,color=3,ai,teal
        recruit=Fire Wraith
        gold,income={ON_DIFFICULTY4 30 40 50 50},{ON_DIFFICULTY4 4 5 6 6} # assume villages used for upkeep
        no_leader,team_name,user_team_name=yes,konrad,_"Elensefar"
        {FLAG_VARIANT6 ragged}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES 3 3}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 3 "Giant Mudcrawler" {ON_DIFFICULTY4 2 2 3 3}}
    {STARTING_VILLAGES_AREA 3 17 15 5}
    {STARTING_VILLAGES_AREA 3 27 14 2}
    
#define ELENSEFARIAN_AVOID_AREA
    x= 0-17,  18,  18,   18,   19,  19,   19,   20,  20,   20,   21,  21,21,21,   22,  22,   23,  23,23,   24,  24,24,   25,  25,   26,  26,26,   27,  27,   28,  28,28,   29,  29,29,   30,  30,    31-99,31-99
    y=22-99,  0-10,15-16,22-99,0-11,14-16,21-99,0-11,14-15,20-99,0-13,15,21,23-99,0-13,23-99,0-12,20,23-99,0-12,20,23-99,0-13,24-99,0-12,19,22-99,0-12,23-99,0-11,19,21-99,0-12,20,22-99,0-12,20-99,  0-13,20-99
#enddef                                       # 20,11 is avoided so that mudcrawlers don't block the granite golem
    [event]
        name=side 2 turn
        first_time_only=no
        {RESET_SIDE_AI 2,3 offensive 0.1 0.8}
#         {VARY_AI_BY_SCHEDULE 2,3} # likely to cause lag, and not relevant since we're already fighting within strict [avoid]s
        
        {MODIFY_SIDE_AI 2 ({GOAL_SEEK_SIDE 3 4,5,6,9 0})}
        {MODIFY_SIDE_AI 3 ({GOAL_SEEK_SIDE 3   7,8,9 0})}
        
        {MODIFY_SIDE_AI 2 (
            {GOAL_LOCATION 4 x,y=29,21}
            {GOAL_LOCATION 4 x,y=27,22}
            {GOAL_LOCATION 4 x,y=25,23}
            {GOAL_LOCATION 3 x,y=26,21}
            {GOAL_LOCATION 3 x,y=24,22}
        )}
        
        {MODIFY_SIDE_AI 3 (
            {GOAL_LOCATION 4 x,y=27,13}
            {GOAL_LOCATION 4 x,y=19,12}
            {GOAL_LOCATION 4 x,y=20,11}
            {GOAL_LOCATION 3 x,y=30,13}
            {GOAL_LOCATION 3 x,y=26,15}
        )}
        
        {MODIFY_SIDE_AI 2,`3 (
            {GOAL_LOCATION 2 x,y=22,19}
            {GOAL_LOCATION 2 x,y=23,18}
            {GOAL_LOCATION 2 x,y=19,20}
            {GOAL_LOCATION 1 x,y=28,18}
            {GOAL_LOCATION 1 x,y=27,19}
            {GOAL_LOCATION 1 x,y=20,17}
        )}
        
        {MODIFY_SIDE_AI 2,3 ([avoid] 
            {ELENSEFARIAN_AVOID_AREA}
        [/avoid])}
    [/event]
    
    
    #############################
    # ARMY OF WESNOTH
    #############################
#define WESNOTH_SIDE SIDE TYPE ID TRAITS RECRUIT_LIST GOLD INCOME
    [side]
        side,controller,color={SIDE},ai,purple
        type,id,facing={TYPE},{ID},nw {MODIFICATIONS( {TRAITS} )}
        gold,income,recruit={GOLD},{INCOME},{RECRUIT_LIST}
        team_name,user_team_name=bad,_"Army of Wesnoth" {FLAG_VARIANT loyalist}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES {SIDE} 1}
    [event]
        name,first_time_only=side {SIDE} turn,no
        {RESET_SIDE_AI {SIDE} offensive 0.4 0.25}
        {VARY_AI_BY_SCHEDULE_ENEMY_NIGHTTIME {SIDE} 1,2,3}
    [/event]
#enddef
    {WESNOTH_SIDE 4 Halberdier wesnoth4 ({TRAIT_RESILIENT}{TRAIT_INTELLIGENT})  "Spearman" {ON_DIFFICULTY4 40 80 160 160} {ON_DIFFICULTY4 2 6 14 14}}
    {WESNOTH_SIDE 5 Longbowman wesnoth5 ({TRAIT_RESILIENT}{TRAIT_STRONG}     )  "Bowman"   {ON_DIFFICULTY4 30 60 120 120} {ON_DIFFICULTY4 1 4 10 10}}
    {WESNOTH_SIDE 6 Lieutenant wesnoth6 ({TRAIT_STRONG}   {TRAIT_RESILIENT}  )  "Fencer"   {ON_DIFFICULTY4 30 60 120 120} {ON_DIFFICULTY4 1 4 10 10}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Pikeman"   {ON_DIFFICULTY4 0 1 1 1}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 4 "Swordsman" {ON_DIFFICULTY4 0 0 1 1}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 5 "Spearman"  {ON_DIFFICULTY4 1 1 2 2}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 6 "Duelist"   {ON_DIFFICULTY4 0 1 1 1}}
    {STARTING_VILLAGES_AREA 4  32 29  5}
    {STARTING_VILLAGES_AREA 5  14 32  9}
    {STARTING_VILLAGES_AREA 6  53 31 10}
    
    
    #############################
    # CLAN FOXTAIL
    #############################
#define FOXTAIL_SIDE SIDE TYPE ID TRAITS RECRUIT_LIST GOLD INCOME
    [side]
        side,controller,color={SIDE},ai,orange
        type,id,facing={TYPE},{ID},se {MODIFICATIONS( {TRAITS} )}
        gold,income,recruit={GOLD},{INCOME},{RECRUIT_LIST}
        team_name,user_team_name=bad,_"Clan Foxtail" {FLAG_VARIANT6 ragged}
    [/side]
    {SILENTLY_LIMIT_LEADER_MOVES {SIDE} 1}
    [event]
        name,first_time_only=side {SIDE} turn,no
        {RESET_SIDE_AI {SIDE} offensive 0.4 0.25}
        [if] {VARIABLE_CONDITIONAL turn_number greater_then 4} {THEN( # otherwise we retreat from the handful of units that start near our keeps
            {VARY_AI_BY_SCHEDULE_ENEMY {SIDE} 1,2,3}
        )} [/if]
    [/event]
#enddef
    {FOXTAIL_SIDE 7 "Orcish Slurbow"  foxtail7 ({TRAIT_RESILIENT}{TRAIT_INTELLIGENT})  "Orcish Archer"   {ON_DIFFICULTY4 40 80 160 160} {ON_DIFFICULTY4 2 6 14 14}}
    {FOXTAIL_SIDE 8 "Goblin Pillager" foxtail8 ({TRAIT_RESILIENT}{TRAIT_STRONG}     )  "Goblin Pillager" {ON_DIFFICULTY4 30 60 120 120} {ON_DIFFICULTY4 1 4 10 10}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Orcish Crossbowman" {ON_DIFFICULTY4 0 1 3 3}} # 1 guard on Hard/Nightmare
    {LIMIT_CONTEMPORANEOUS_RECRUITS 7 "Orcish Grunt"       {ON_DIFFICULTY4 1 2 3 3}} # 1 guard on Normal/Hard/Nightmare
    {LIMIT_CONTEMPORANEOUS_RECRUITS 8 "Orcish Archer"      {ON_DIFFICULTY4 1 2 3 3}}
    {LIMIT_CONTEMPORANEOUS_RECRUITS 8 "Orcish Grunt"       {ON_DIFFICULTY4 0 1 1 1}} # 1 guard on Hard/Nightmare
    {STARTING_VILLAGES_AREA 7  31-99 0-9 0}
    {STARTING_VILLAGES_AREA 8   0-30 0-9 0}
    
    
    
    
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                    PREPARE MAP
    #######################################################################################################################################################
    [event]
        name=prestart
        
        #############################
        # DELFADOR
        #############################
        # golems
        {GENERIC_UNIT 3 "Granite Golem" 23 18} {FACING ne} {ZONE_GUARDIAN 23 18 x,y,radius=22,18,2}
        {GENERIC_UNIT 3 "Granite Golem" 30 13} {FACING nw} {ZONE_GUARDIAN 30 13 (
            x=26,   27,   28,   29,   30,   31
            y=12-13,12-15,11-15,12-16,12-14,14 )}
        {GENERIC_UNIT 3 "Granite Golem" 21 10} {FACING ne} {ZONE_GUARDIAN 20 11 x,y,radius=18,12,3} {HITPOINTS 87} {ROLE golem1} # deliberately out of position; it starts fighting some orcs
        [event]
            name,first_time_only=side 3 turn refresh,no
            # golem1 spawns injured and isn't stationed on a village, so go back to heal if there's no enemies nearby
            {FILTER_CONDITION({HAVE_UNIT( role,formula=golem1,"(self.hitpoints < self.max_hitpoints)" )})}
            {FILTER_CONDITION({HAVE_UNIT( role=golem1 {FILTER_LOCATION x,y,radius=19,12,1} )})} 
            {FILTER_CONDITION({NOT({HAVE_UNIT x,y=19,12})})}
            
            {FILTER_CONDITION({NOT({HAVE_UNIT( side=7,8               {FILTER_LOCATION x,y,radius=20,11,2} )})})}
            {FILTER_CONDITION({NOT({HAVE_UNIT( type="Goblin Pillager" {FILTER_LOCATION x,y,radius=21,10,3} )})})}
            
            {MOVE_UNIT role=golem1 19 12} {MODIFY_UNIT role=golem1 moves 0}
        [/event]
        
        # some attackers (they'll get killed ina couple of turns)
        {GENERIC_UNIT 3 "Fire Wraith"      31 10} {FACING ne} {ZONE_GUARDIAN 31 10 x,y,radius=31,10,5} {HITPOINTS 19}
        {GENERIC_UNIT 3 "Fire Guardian"    30  8} {FACING ne} {ZONE_GUARDIAN 31 10 x,y,radius=31,10,5} {HITPOINTS 23}
        {GENERIC_UNIT 3 "Giant Mudcrawler" 31 12} {FACING ne} {ZONE_GUARDIAN 31 10 x,y,radius=31,10,5}
        
        # small island mudcrawlers
        {GENERIC_UNIT 3 "Mudcrawler"       20 11} {FACING se}
        {GENERIC_UNIT 3 "Mudcrawler"       17 13} {FACING se}
        {GENERIC_UNIT 3 "Mudcrawler"       16 12} {FACING se}
        
        
        #############################
        # MADDOCK
        #############################
        {BRAZIER_DYNAMIC_DAY 25 21 OFFSET={TOD_OFFSET}}
        {BRAZIER_DYNAMIC_DAY 21 19 OFFSET={TOD_OFFSET}}
        {BRAZIER_DYNAMIC_DAY 26 13 OFFSET={TOD_OFFSET}}
        
        {GENERIC_UNIT 3 "Swordsman" 27 13} {FACING ne} {ZONE_GUARDIAN 27 13 x,y,radius=27,14,2}
        {GENERIC_UNIT 3 "Swordsman" 19 17} {FACING se} {ZONE_GUARDIAN 19 17 x,y,radius=21,18,3}
        {GENERIC_UNIT 3 "Pikeman"   22 19} {FACING se} {ZONE_GUARDIAN 22 19 x,y,radius=21,19,2}
        {GENERIC_UNIT 3 "Thief"     28 18} {FACING ne} {ZONE_GUARDIAN 28 18 x,y,radius=28,18,1}
        {GENERIC_UNIT 3 "Swordsman" 25 23}
        {GENERIC_UNIT 3 "Thief"     24 22} {HITPOINTS 11}
        {GENERIC_UNIT 3 "Pikeman"   29 21}
        {GENERIC_UNIT 3 "Pikeman"   28 21} {HITPOINTS 9}
        {GENERIC_UNIT 3 "Thief"     28 22} {HITPOINTS 19}
        {GENERIC_UNIT 3 "Thief"     27 22}
        
        
        #############################
        # ARMY OF WESNOTH
        #############################
        {PLACE_IMAGE items/dwarven-keep-tile.png 34 31}
        
        # initial attackers
        {GENERIC_UNIT 6 "Spearman" 30 21} {FACING nw} {HITPOINTS 31}
        {GENERIC_UNIT 6 "Spearman" 29 22} {FACING ne} {HITPOINTS 16}
        {GENERIC_UNIT 6 "Spearman" 29 23} {FACING nw} {HITPOINTS 18}
        
        {GENERIC_UNIT 6 "Bowman"   22 24} {FACING ne}
        {GENERIC_UNIT 6 "Bowman"   23 25} {FACING ne}
        
        {GENERIC_UNITC 4 ({ON_DIFFICULTY4 "none"     "Spearman"   "Spearman"   "Spearman"  }) 33 32 ({FACING sw}{ZONE_GUARDIAN 33 32 x,y,radius=34,30,3})}
        {GENERIC_UNITC 4 ({ON_DIFFICULTY4 "none"     "Bowman"     "Longbowman" "Longbowman"}) 39 29 ({FACING se}{ZONE_GUARDIAN 39 29 x,y,radius=37,29,3})}
        {GENERIC_UNITC 4 ({ON_DIFFICULTY4 "none"     "none"       "Bowman"     "Bowman"    }) 38 28 ({FACING se}{ZONE_GUARDIAN 38 28 x,y,radius=34,30,3})}
        {GENERIC_UNITC 4 ({ON_DIFFICULTY4 "Bowman"   "Bowman"     "Longbowman" "Longbowman"}) 34 26 ({FACING nw}{GUARDIAN})}
        
        {GENERIC_UNITC 5 ({ON_DIFFICULTY4 "Spearman" "Spearman"   "Spearman"   "Spearman"  }) 26 28 ({FACING sw}{GUARDIAN})}
        {GENERIC_UNITC 5 ({ON_DIFFICULTY4 "none"     "none"       "Bowman"     "Bowman"    }) 18 30 ({FACING sw}{ZONE_GUARDIAN 18 30 x,y,radius=28,28,4})}
        
        {GENERIC_UNITC 5 ({ON_DIFFICULTY4 "none"     "none"       "Fencer"     "Fencer"    }) 40 23 ({FACING sw}{ZONE_GUARDIAN 40 23 x,y,radius=28,28,4})}
        {GENERIC_UNITC 6 ({ON_DIFFICULTY4 "Fencer"   "Fencer"     "Duelist"    "Duelist"   }) 43 24 ({FACING sw}{ZONE_GUARDIAN 43 24 x,y,radius=39,22,5})}
        
        
        #############################
        # CLAN FOXTAIL
        #############################
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "none"          "none"          "Orcish Archer"      "Orcish Archer"     }) 35  6 ({FACING sw}{ZONE_GUARDIAN 35  6 x,y,radius=33,8,4})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "Orcish Archer" "Orcish Archer" "Orcish Crossbowman" "Orcish Crossbowman"}) 35  8 ({FACING sw}{ZONE_GUARDIAN 31 10 x,y,radius=33,8,4}{HITPOINTS 21})}
        {GENERIC_UNITC 7 ({ON_DIFFICULTY4 "none"          "Orcish Grunt"  "Orcish Grunt"       "Orcish Grunt"      }) 34  9 ({FACING sw}{ZONE_GUARDIAN 34  9 x,y,radius=33,8,4})}
        {GENERIC_UNIT  7 "Orcish Crossbowman" 32  9} {FACING sw} {HITPOINTS 4}
        {GENERIC_UNIT  7 "Orcish Grunt"       31  9} {FACING sw}
        
        {GENERIC_UNITC 8 ({ON_DIFFICULTY4 "none"          "Orcish Archer" "Orcish Crossbowman" "Orcish Crossbowman"}) 26 6 ({FACING sw}{GUARDIAN})}
        {GENERIC_UNITC 8 ({ON_DIFFICULTY4 "none"          "none"          "Orcish Grunt"       "Orcish Grunt"      }) 25 4 ({FACING se}{GUARDIAN})}
        {GENERIC_UNIT  8 "Orcish Archer" 21  9} {FACING se}
        {GENERIC_UNIT  8 "Orcish Archer" 22 10} {FACING nw}
        {GENERIC_UNIT  8 "Orcish Grunt"  20  9} {FACING se} {HITPOINTS 7}
        
        
        #############################
        # KONRAD
        #############################
        {PUT_TO_RECALL_LIST id=Konrad}
        {SCROLL_TO 31 24}
    [/event]
    #######################################################################################################################################################
    #                                                                    PLAY SCENARIO
    #######################################################################################################################################################
    [event]
        name=start
        
        #############################
        # BLAGGARDS
        #############################
        {DELAY 500}
        [message]
            speaker=wesnoth6
            message=_"Push, you blaggards! We take the isle or it’s back to the gallows for us all!"
        [/message]
        {DELAY 250}
        {ANIMATE_HARM x,y=29,23 13 range=melee x,y=28,22}
        {ANIMATE_HARM x,y=29,23 99 range=melee x,y=28,22}
        {DELAY 250}
        {ANIMATE_HARM x,y=29,22 99 range=melee x,y=28,21}
        {DELAY 250}
        {ANIMATE_HARM x,y=30,21 10 range=melee x,y=29,21}
        {ANIMATE_HARM x,y=30,21 10 range=melee x,y=29,21}
        {ANIMATE_HARM x,y=29,21 99 range=melee x,y=30,21}
        {DELAY 500}
        # retaliation
        {MOVE_UNIT x,y=27,22 28 23}
        {ANIMATE_HARM x,y=28,23 99 range=melee x,y=29,23}
        {DELAY 250}
        {ANIMATE_HARM x,y=29,21 99 range=melee x,y=29,22}
        {DELAY 250}
        {MOVE_UNIT id=wesnoth6 34 24}
        [message]
            speaker=wesnoth6
            message=_"Damnations, still no progress! The defenders can’t keep this up forever — prepare another wave."
        [/message]
        {DELAY 500}
        [event]
            name=side 6 turn refresh
            {MOVE_UNIT id=wesnoth6 39 24} # otherwise he makes for the slighty-closer southern keep, which is already occupied
        [/event]
        
        #############################
        # KONRAD ARRIVES
        #############################
        [if] {VARIABLE_CONDITIONAL elensefar_from_north equals yes} {THEN(
            {RECALL_KONRAD_AND_COMPANIONS 45 1}
            {MODIFY_UNIT id=Konrad facing sw}
            {MODIFY_TERRAIN Ke 45 1} [redraw][/redraw] {DELAY 150}
            {MODIFY_TERRAIN Ce 44 0} [redraw][/redraw] {DELAY 150}
            {MODIFY_TERRAIN Ce 44 1} [redraw][/redraw] {DELAY 150}
            {MODIFY_TERRAIN Ce 45 2} [redraw][/redraw] {DELAY 150}
            {MODIFY_TERRAIN Ce 46 1} [redraw][/redraw] {DELAY 150}
            [capture_village]
                side,x,y,radius=0,58,4 # set to neutral
            [/capture_village]
        )}
        [elseif] {VARIABLE_CONDITIONAL elensefar_from_west equals yes} {THEN(
            {GENERIC_UNIT 1 Boat 1 36} {ROLE arrival_boat}
            {MOVE_UNIT role=arrival_boat 5 36} {KILL role=arrival_boat}
            {RECALL_XY Konrad 5 36} {MODIFY_UNIT id=Konrad facing se}
            {MOVE_UNIT id=Konrad 7 36}
            {MODIFY_TERRAIN Ke 7 36} [redraw][/redraw] {DELAY 150}
            {MODIFY_TERRAIN Ce 8 35} [redraw][/redraw] {DELAY 150}
            {MODIFY_TERRAIN Ce 8 36} [redraw][/redraw] {DELAY 150}
            {MODIFY_TERRAIN Ce 7 37} [redraw][/redraw] {DELAY 150}
            {RECALL_KONRAD_AND_COMPANIONS 7 36}
            [capture_village]
                side,x,y,radius=1,7,34,5 # set to neutral
            [/capture_village]
        )} [/elseif]
        {ELSE( # default spawn location - southeast
            {RECALL_XY Konrad 58 34} {MODIFY_UNIT id=Konrad facing sw}
            {MOVE_UNIT id=Konrad 56 33}
            {MODIFY_TERRAIN Ke 56 33} [redraw][/redraw] {DELAY 150}
            {MODIFY_TERRAIN Ce 55 34} [redraw][/redraw] {DELAY 150}
            {MODIFY_TERRAIN Ce 55 33} [redraw][/redraw] {DELAY 150}
            {MODIFY_TERRAIN Ce 56 32} [redraw][/redraw] {DELAY 150}
            {RECALL_KONRAD_AND_COMPANIONS 56 33}
            [capture_village]
                side,x,y,radius=0,51,34,6 # set to neutral
            [/capture_village]
        )} [/if]
        {CLEAR_VARIABLE elensefar_from_west,elensefar_from_north}
        
        #############################
        # KONRAD DIALOGUE
        #############################
        {DELAY 500}
        {SCROLL_TO 19 25} {DELAY 500}
        {SCROLL_TO 28  9} {DELAY 500}
        [message]
            speaker=Konrad
            message=_"Delfador and Lord Maddock are hard-pressed! While Asheviere's loyalists besiege the south bridge, orcs and trolls push in from the north."
        [/message]
        [message]
            speaker=Konrad
            message=_"Delfador advised me to turn back, but I know I can make a difference in this fight. If we defeat enough of their leaders, they will be forced to break off the siege!"
        [/message]
        
        #############################
        # OBJECTIVES
        #############################
        [objectives]
            [objective]
                description= _ "Defeat 3 enemy leaders"
                condition=win
            [/objective]
            {OBJECTIVES_HERODEATHS}
            [gold_carryover]
                carryover_percentage,bonus=40,no
            [/gold_carryover]
        [/objectives]
    [/event]
    
    #############################
    # FLAVOR
    #############################
    [event]
        name=turn 3
        [message]
            speaker=Konrad
            message=_"I read about this place in Delfador’s books. The peninsula of pearls used to have a small, thriving town. Farmers, fishers... Muff Malal must have killed them all, while the queen’s armies did nothing to help."
        [/message]
        {FIND_COMPANION_AND_SAY
            MESSAGE_DELFADOR=_"More of her politicking, I’m afraid. By allowing necromancy to flourish in the kingdom’s western regions, Asheviere forces us to devote time and resources to protecting the townsfolk — time we can no longer spend fighting her directly."
            MESSAGE_HARPER=_"She’s a real piece of work, isn’t she? I’ll bet she let this happen on purpose, to keep all us rebels busy while she be livin’ luxury up in Weldyn. If’n for Baldras and Relana, this could’ve been me..."
            MESSAGE_ALLARIL=_"Aye, tha’ human-queen ’o yers is a filthy, white-livered, chicken-hearted skinflint o’ a poltroon, she is! Dinnae you worry son, when we git our hands on her ah’ll tear her queenly flesh t’ shreds!"
        }
    [/event]
    [event]
        name=turn 10
        {FIRE_EVENT say_smalltalk}
    [/event]
    
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                  RESCUE PRISONERS
    #######################################################################################################################################################
    [event]
        name=moveto
        {FILTER( side=1 {FILTER_ADJACENT id=Moremirmu} )}
        {FIRE_EVENT free_moremirmu}
    [/event]
    [event]
        name=free_moremirmu
        [message]
            speaker=Moremirmu
            message=_"Lo and behold! I stood in need of aid, and so aid has come! What brings you to Muff Malal’s peninsula, pilgrims?"
        [/message]
        [message]
            speaker=Konrad
            message=_"I am Konard, heir to the throne of Wesnoth, and seeking to reclaim my seat from the evil queen Asheviere! Who are you?"
        [/message]
        [message]
            speaker=Moremirmu
            message=_"Brother Moremirmu, wandering warrior, at your service. Rejoice, for it seems the strands of fate have brought us here together, that we may unite in arms towards the vanquishing of evil!"
        [/message]
        [if] {HAVE_UNIT id="Muff Malal"} {THEN(
            [message]
                speaker=Moremirmu
                message=_"Aid me in my quest against this foul necromancer, and I shall ever-more be your loyal companion in the eternal war against the darkness!"
            [/message]
        )} [/if]
        {MODIFY_UNIT id=Moremirmu side 1}
        {MODIFY_UNIT id=Moremirmu moves 5}
        {MODIFY_UNIT id=Moremirmu attacks_left 1}
        [message]
            speaker,image=narrator,wesnoth-icon.png
            message=_"Moremirmu has joined your party!"
        [/message]
    [/event]
    
    #############################
    # MOREMIRMU ATTACKS
    #############################
    [event]
        name=attack {FILTER        id=Moremirmu}
        {FIRE_EVENT moremirmu_speaks}
    [/event]
    [event]
        name=attack {FILTER_SECOND id=Moremirmu}
        {FIRE_EVENT moremirmu_speaks}
    [/event]
    [event]
        name=moremirmu_speaks
        [message]
            speaker=Moremirmu
            message=_"The Light rebukes you, foul demon of the night! In a blaze of brilliance shall you be purged!"
        [/message]
    [/event]
    
    
    
    
    
    #######################################################################################################################################################
    #                                                                  VICTORY / DEFEAT
    #######################################################################################################################################################
    #############################
    # MUFF MALAL DIES
    #############################
    [event]
        name=last breath
        {FILTER id="Muff Malal"}
        [message]
            speaker=Muff Malal
            message=_"Curse you all! The queen promised I would be left in peace here..."
        [/message]
        {KILL id="Muff Malal" ANIMATE=yes}
        {KILL_COUNT 4 side=2,3 ANIMATE=yes}
        {KILL side=2,3}
        {DELAY 500}
        
        [if] {HAVE_UNIT side,id=4,Moremirmu} {THEN(
            [message]
                speaker=Konrad
                message=_"The necromancer is defeated, and the countryside is safe once more! Good work, everybody."
            [/message]
            {FIRE_EVENT free_moremirmu}
        )} {ELSE(
            [if] {HAVE_UNIT id=Moremirmu} {THEN(
                [message]
                    speaker=Konrad
                    message=_"The necromancer is defeated, and the countryside is safe once more! Good work, everybody."
                [/message]
                [message]
                    speaker=Moremirmu
                    message=_"The Light shall always find the Light, and so have I found you! Let us quest on together in opposition to the dark queen!"
                [/message]
            )} {ELSE(
                [message]
                    speaker=Konrad
                    message=_"The necromancer is defeated, and the countryside is safe once more! I am sorry that Moremirmu has perished, but at least he did not die in vain. Now we must continue onwards!"
                [/message]
            )} [/if]
        )} [/if]
        
        [endlevel]
            result=victory
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]
[/scenario]




#undef ELENSEFARIAN_AVOID_AREA
#undef WESNOTH_SIDE
#undef FOXTAIL_SIDE
#undef TOD_OFFSET
#undef SCENARIO_TURN_LIMIT
